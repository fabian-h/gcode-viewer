{"version":3,"sources":["app/UIStore.ts","app/gcode-parser.ts","components/GCodeViewer.tsx","components/LiveGCodeViewer.tsx","app/file-upload.ts","components/GCodeDropzone.tsx","components/StaticGCodeViewer.tsx","components/DrawSettings.tsx","components/Statistics.tsx","components/App.tsx","index.tsx"],"names":["store","_dec","action","bound","_dec2","_dec3","observable","ref","_class","UIStore","Object","classCallCheck","this","initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","createClass","key","value","setting","n","activeLayer","newTransform","transform","gcode","activeGCode","get","numberOfLayers","applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","k","x","y","lineWidth","coloringMode","toolColors","scaleLinewidth","getOwnPropertyDescriptor","computed","STATE_NONE","CHAR_0","charCodeAt","CHAR_9","CHAR_DOT","CHAR_MINUS","CHAR_SPACE","CHAR_TAB","CHAR_A","CHAR_Z","CHAR_LF","CHAR_CR","CHAR_SEMICOLON","COMMANDS","MOVE_WITH_EXTRUSION","MOVE_WITHOUT_EXTRUSION","SET_FEED_RATE","RETRACTION","LAYER_CHANGE","TOOL_CHANGE","INSTRUCTION_ARRAY_BLOCK_SIZE","LOOKUP_BEFORE_DOT","LOOKUP_AFTER_DOT","GCodeParser","state","field","value_start","dot_position","prev_character","field_values","Float32Array","axis_coordinates_absolute","extruder_coordinates_absolute","feed_rate","current_tool","prev_z","last_z_with_extrusion","last_feed_rate_with_extrusion","current_layer_index","layer_positions","layer_heights","prev_x","prev_y","prev_e","instructions","Instructions","byte_index","last_block","statistics","min","Infinity","max","z","extruded_feed_rate","tools","extrusion","fill","NaN","gcodeArrayBuffer","c","data","Uint8Array","i","length","undefined","temp_data","Array","from","concat","slice","temp_dot_position","j","pFloat","isNaN","addInstruction","command","x_coord","y_coord","push","totalInstructions","data_start","data_end","dot_location","result","negative","layerPositions","layerHeights","lineIndex","blockSizeInInstructions","buffers","currentBuffer","currentInstruction","currentFloat32Array","ArrayBuffer","param1","param2","StyledCanvas","styled","canvas","_templateObject","OverlayDiv","div","_templateObject2","GCodeViewer","observer","_ref","currentLayer","setTransform","drawSettings","_useState","useState","_useState2","slicedToArray","context","setContext","useRef","doZoom","event","draw","current","save","clearRect","width","height","restore","clearCanvas","to","devicePixelRatio","feedRateScale","scaleLinear","domain","range","prevX","prevY","lineCap","beginPath","currentF32Buffer","firstBuffer","Math","floor","lastBuffer","offset","end","moveTo","lineTo","stroke","strokeStyle","interpolateInferno","color","drawInstructions","useEffect","getContext","zoomBehaviour","zoom","on","scaleExtent","select","react","resizeSensor","onResize","currentHeight","clientHeight","currentWidth","clientWidth","window","toFixed","LiveGCodeViewer","_ref$UIStore","connection","progress","currentLine","bytepos","getLineByBytePos","filepos","findLayerByLine","components_GCodeViewer","uploadGCodeFiles","files","Promise","resolve","reject","file","reader","FileReader","parser","t0","performance","now","readSlice","s","readAsArrayBuffer","onload","parse","size","delta","fileSizeMB","console","log","parsingResult","getParsingResult","objectSpread","name","DropzoneContainer","GCodeDropzone_templateObject","CenteredParagraph","p","GCodeDropzone_templateObject2","GCodeDropzone","onFileLoad","onDrop","useCallback","_ref2","asyncToGenerator","regenerator_default","a","mark","_callee","acceptedFiles","wrap","_context","prev","next","setActiveGCode","sent","stop","_x","apply","arguments","_useDropzone","useDropzone","getRootProps","getInputProps","isDragActive","react_default","createElement","StyledDiv","StaticGCodeViewer_templateObject","StaticGCodeViewer","isDragging","setDragging","onDragOver","e","onDragLeave","DrawSettingsButton","props","isOpen","setOpen","buttons","className","icon","text","onClick","SettingsDrawer","assign","handleClose","objectWithoutProperties","drawer","hasBackdrop","onClose","title","Classes","DRAWER_BODY","DIALOG_BODY","DrawSettings_DrawSettings","DrawSettings","formGroup","label","labelFor","numericInput","id","onValueChange","newValue","controls","checked","onChange","target","radioGroup","selectedValue","changeEvent","StatisticsModal","dialog","ToolTable","htmlTable","bordered","condensed","map","tool","index","FocusStyleManager","onlyShowFocusOnTabs","GridContainer","App_templateObject","TopbarContainer","App_templateObject2","ViewerContainer","_templateObject3","ToolContainer","_templateObject4","App","IProps","navbar","Group","align","Alignment","LEFT","Heading","Divider","setDrawSetting","Statistics","trackProgress","components_LiveGCodeViewer","components_StaticGCodeViewer","slider","disabled","labelStepSize","ceil","setActiveLayer","ReactDOM","components_App","document","getElementById"],"mappings":"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","file":"static/js/main.89077c6e.chunk.js","sourcesContent":["/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport { observable, action, computed } from \"mobx\";\nimport { Instructions, IStatistics } from \"./gcode-parser\";\nimport { ITransform } from \"components/GCodeViewer\";\nimport OctoprintConnection from \"./OctoprintConnection\";\n\nexport class UIStore {\n  @observable\n  transform: ITransform = { k: 1, x: 0, y: 0 };\n\n  @observable\n  activeLayer: number = 0;\n\n  @observable\n  trackProgress: boolean = false;\n\n  @observable\n  drawSettings: IDrawSettings = {\n    lineWidth: 8,\n    coloringMode: \"feed_rate\",\n    toolColors: [\"blue\", \"green\", \"red\", \"orange\", \"black\"],\n    scaleLinewidth: true\n  };\n\n  @action.bound\n  setDrawSetting(setting: keyof IDrawSettings, value: any) {\n    //this.drawSettings[setting] = value;\n  }\n\n  @computed\n  get numberOfLayers() {\n    return this.activeGCode === null ? 0 : this.activeGCode.numberOfLayers;\n  }\n\n  @action\n  setActiveLayer(n: number) {\n    this.activeLayer = n;\n  }\n\n  @action.bound\n  setTransform(newTransform: ITransform) {\n    this.transform = newTransform;\n  }\n\n  @action\n  setActiveGCode(gcode: IGCode | null) {\n    /*if (gcode) {\n      this.setTransform({\n        k: 3,\n        x: gcode.statistics.x.min || 0,\n        y: gcode.statistics.y.min || 0,\n      });\n    }*/\n    this.activeGCode = gcode;\n    this.activeLayer = 1;\n  }\n\n  @observable.ref\n  activeGCode: IGCode | null = null;\n}\n\nconst store = new UIStore();\nexport default store;\n\nexport interface IGCode {\n  name: string;\n  instructions: Instructions;\n  layerPositions: number[];\n  layerHeights: number[];\n  numberOfLayers: number;\n  statistics: IStatistics;\n  connection?: OctoprintConnection;\n  lineIndex: number[];\n}\n\nexport interface IDrawSettings {\n  lineWidth: number;\n  coloringMode: string; // \"feed_rate\" | \"tool\";\n  toolColors: string[];\n  scaleLinewidth: boolean;\n}\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\ninterface IMinMax {\n  min: number;\n  max: number;\n}\n\ninterface ITool {\n  extrusion: number;\n}\nexport interface IStatistics {\n  x: IMinMax;\n  y: IMinMax;\n  z: IMinMax;\n  feed_rate: IMinMax;\n  extruded_feed_rate: IMinMax;\n  tools: ITool[];\n}\n\nconst STATE_NONE = 0;\nconst STATE_FIELD = 1;\nconst STATE_COMMENT = 2;\n\nconst E = 4;\nconst F = 5;\nconst G = 6;\nconst M = 12;\nconst T = 19;\nconst X = 23;\nconst Y = 24;\nconst Z = 25;\n\nconst CHAR_0 = \"0\".charCodeAt(0);\nconst CHAR_9 = \"9\".charCodeAt(0);\nconst CHAR_DOT = \".\".charCodeAt(0);\nconst CHAR_MINUS = \"-\".charCodeAt(0);\nconst CHAR_SPACE = \" \".charCodeAt(0);\nconst CHAR_TAB = \"\\t\".charCodeAt(0);\nconst CHAR_A = \"A\".charCodeAt(0);\nconst CHAR_Z = \"Z\".charCodeAt(0);\nconst CHAR_LF = \"\\n\".charCodeAt(0);\nconst CHAR_CR = \"\\r\".charCodeAt(0);\nconst CHAR_SEMICOLON = \";\".charCodeAt(0);\n\nexport const COMMANDS = {\n  MOVE_WITH_EXTRUSION: 1, // parameters: X,Y\n  MOVE_WITHOUT_EXTRUSION: 2, // parameters: X,Y\n  SET_FEED_RATE: 3, // parameters: F\n  RETRACTION: 4,\n  LAYER_CHANGE: 5, // parameters: Z\n  TOOL_CHANGE: 6\n};\n\nconst INSTRUCTION_ARRAY_BLOCK_SIZE = 1024 * 32;\n\nconst LOOKUP_BEFORE_DOT = [1, 10, 100, 1000, 10000, 100000, 1000000];\nconst LOOKUP_AFTER_DOT = [0.1, 0.01, 0.001, 0.0001, 0.00001, 0.000001];\n\nexport default class GCodeParser {\n  state = STATE_NONE;\n  field: number = 0;\n  value_start: number | undefined;\n  dot_position: number | undefined;\n  prev_character: number | undefined;\n  field_values = new Float32Array(27);\n\n  axis_coordinates_absolute = true;\n  extruder_coordinates_absolute = false;\n  feed_rate = 0;\n  current_tool = 0;\n\n  // for layer change detection\n  prev_z: number = 0;\n  last_z_with_extrusion: number | undefined;\n  last_feed_rate_with_extrusion: number | undefined;\n  current_layer_index = 0;\n  layer_positions: number[] = [];\n  layer_heights: number[] = [];\n\n  prev_x = 0;\n  prev_y = 0;\n  prev_e = 0;\n\n  instructions = new Instructions(INSTRUCTION_ARRAY_BLOCK_SIZE);\n\n  byte_index = 0;\n  //line_index: number[] = [];\n\n  last_block: Uint8Array | undefined;\n\n  constructor() {\n    this.field_values.fill(NaN);\n  }\n\n  statistics: IStatistics = {\n    x: {\n      min: Infinity,\n      max: -Infinity\n    },\n    y: {\n      min: Infinity,\n      max: -Infinity\n    },\n    z: {\n      min: 0,\n      max: -Infinity\n    },\n    feed_rate: {\n      min: Infinity,\n      max: -Infinity\n    },\n    extruded_feed_rate: {\n      min: Infinity,\n      max: -Infinity\n    },\n    tools: [\n      {\n        extrusion: 0\n      }\n    ]\n  };\n\n  parse(gcodeArrayBuffer: ArrayBuffer) {\n    const data = new Uint8Array(gcodeArrayBuffer);\n    var c;\n\n    for (let i = 0; i < data.length; ++i) {\n      c = data[i];\n      if ((c >= CHAR_0 && c <= CHAR_9) || c === CHAR_DOT || c === CHAR_MINUS) {\n        //if (STATE_FIELD) {\n        //value += c;\n        //}\n        if (c === CHAR_DOT) this.dot_position = i;\n      } else if (c === CHAR_SPACE || c === CHAR_TAB) {\n        if (this.state === STATE_FIELD && this.value_start) {\n          if (this.last_block !== undefined) {\n            // Special handling for numbers that cross the boundary of data blocks\n            const temp_data = new Uint8Array(\n              Array.from(this.last_block).concat(Array.from(data.slice(0, i)))\n            );\n            let temp_dot_position = temp_data.length;\n            for (let j = 0; j < temp_data.length; ++j) {\n              if (temp_data[j] === CHAR_DOT) temp_dot_position = j;\n            }\n            this.field_values[this.field - 65] = this.pFloat(\n              temp_data,\n              0,\n              temp_data.length,\n              temp_dot_position\n            );\n            this.last_block = undefined;\n          } else {\n            // regular float handling\n            this.field_values[this.field - 65] = this.pFloat(\n              data,\n              this.value_start,\n              i,\n              this.dot_position ? this.dot_position : i\n            );\n          }\n          this.value_start = undefined;\n          this.dot_position = undefined;\n          this.state = STATE_NONE;\n        }\n      } else if (c >= CHAR_A && c <= CHAR_Z) {\n        if (this.state === STATE_NONE) {\n          this.field = data[i];\n          this.state = STATE_FIELD;\n          this.value_start = i + 1;\n          //console.log(\"F\", this.field);\n        }\n      } else if (\n        (c === CHAR_CR || c === CHAR_LF) &&\n        (this.prev_character !== CHAR_CR && this.prev_character !== CHAR_LF)\n      ) {\n        if (STATE_FIELD && this.value_start) {\n          this.field_values[this.field - 65] = this.pFloat(\n            data,\n            this.value_start,\n            i,\n            this.dot_position ? this.dot_position : i\n          );\n        }\n        this.state = STATE_NONE;\n        this.value_start = undefined;\n        this.dot_position = undefined;\n\n        /*console.log(\n        \"G\",\n        this.field_values[G],\n        this.field_values[X],\n        this.field_values[Y],\n        this.field_values[E],\n        this.extruder_coordinates_absolute,\n        this.prev_e,\n        instruction_index\n      );*/\n        // check if this is a G command\n        if (!isNaN(this.field_values[G])) {\n          switch (this.field_values[G]) {\n            case 0: // G0\n            case 1: // G1\n              // The move or extrude command is moving in the XY plane and not the Z plane\n              // We're not handling XYZ movements at this moment\n              if (\n                !isNaN(this.field_values[X]) ||\n                !isNaN(this.field_values[Y])\n              ) {\n                // If E field is set and\n                // - relative extrusion value is positive or\n                // - absolute extrusion value is larger than previous extrusion value\n                // the command is a move with extrusion\n\n                var command;\n                var x_coord;\n                var y_coord;\n\n                if (\n                  !isNaN(this.field_values[E]) &&\n                  ((this.extruder_coordinates_absolute &&\n                    this.field_values[E] > this.prev_e) ||\n                    (!this.extruder_coordinates_absolute &&\n                      this.field_values[E] > 0))\n                ) {\n                  if (this.prev_z !== this.last_z_with_extrusion) {\n                    this.instructions.addInstruction(\n                      COMMANDS.LAYER_CHANGE,\n                      this.prev_z\n                    );\n                    //this.line_index.push(this.byte_index);\n                    this.layer_positions.push(\n                      this.instructions.totalInstructions\n                    );\n                    this.layer_heights.push(this.prev_z);\n                    this.current_layer_index += 1;\n\n                    if (this.prev_z > this.statistics.z.max)\n                      this.statistics.z.max = this.prev_z;\n\n                    // set all relevant parameters at the start of each layer\n                    // so that each layer contains all necessary information\n                    // for displaying it\n                    this.instructions.addInstruction(\n                      COMMANDS.MOVE_WITHOUT_EXTRUSION,\n                      this.prev_x,\n                      this.prev_y\n                    );\n                    this.instructions.addInstruction(\n                      COMMANDS.SET_FEED_RATE,\n                      this.feed_rate\n                    );\n                    this.instructions.addInstruction(\n                      COMMANDS.TOOL_CHANGE,\n                      this.current_tool\n                    );\n                  }\n\n                  command = COMMANDS.MOVE_WITH_EXTRUSION;\n                  this.last_z_with_extrusion = this.prev_z;\n                  if (this.feed_rate !== this.last_feed_rate_with_extrusion) {\n                    if (this.feed_rate > this.statistics.extruded_feed_rate.max)\n                      this.statistics.extruded_feed_rate.max = this.feed_rate;\n                    if (this.feed_rate < this.statistics.extruded_feed_rate.min)\n                      this.statistics.extruded_feed_rate.min = this.feed_rate;\n                  }\n                  this.last_feed_rate_with_extrusion = this.feed_rate;\n\n                  this.statistics.tools[\n                    this.current_tool\n                  ].extrusion += this.field_values[E];\n                } else {\n                  command = COMMANDS.MOVE_WITHOUT_EXTRUSION;\n                }\n\n                // Set X value for move command\n                if (!isNaN(this.field_values[X])) {\n                  if (this.axis_coordinates_absolute)\n                    x_coord = this.field_values[X];\n                  else x_coord = this.prev_x + this.field_values[X];\n                  if (x_coord > this.statistics.x.max)\n                    this.statistics.x.max = x_coord;\n                  if (x_coord < this.statistics.x.min)\n                    this.statistics.x.min = x_coord;\n                } else x_coord = this.prev_x;\n\n                // Set Y value for move command\n                if (!isNaN(this.field_values[Y])) {\n                  if (this.axis_coordinates_absolute)\n                    y_coord = this.field_values[Y];\n                  else y_coord = this.prev_y + this.field_values[Y];\n                  if (y_coord > this.statistics.y.max)\n                    this.statistics.y.max = y_coord;\n                  if (y_coord < this.statistics.y.min)\n                    this.statistics.y.min = y_coord;\n                } else y_coord = this.prev_y;\n                this.instructions.addInstruction(command, x_coord, y_coord);\n                //this.line_index.push(this.byte_index);\n                this.prev_x = x_coord;\n                this.prev_y = y_coord;\n              }\n\n              // Set feed rate if F field is present\n              if (!isNaN(this.field_values[F])) {\n                this.feed_rate = this.field_values[F];\n                this.instructions.addInstruction(\n                  COMMANDS.SET_FEED_RATE,\n                  this.field_values[F]\n                );\n                if (this.feed_rate > this.statistics.feed_rate.max)\n                  this.statistics.feed_rate.max = this.feed_rate;\n                if (this.feed_rate < this.statistics.feed_rate.min)\n                  this.statistics.feed_rate.min = this.feed_rate;\n                //this.line_index.push(this.byte_index);\n              }\n\n              if (!isNaN(this.field_values[Z])) {\n                if (this.field_values[Z] > this.prev_z) {\n                  this.instructions.addInstruction(COMMANDS.RETRACTION);\n                  //this.line_index.push(this.byte_index);\n                }\n                this.prev_z = this.field_values[Z];\n              }\n\n              break;\n            case 90: // G90\n              this.axis_coordinates_absolute = true;\n              break;\n            case 91: // G91\n              this.axis_coordinates_absolute = false;\n              break;\n          }\n        }\n        // check if this is a G command\n        else if (!isNaN(this.field_values[M])) {\n          switch (this.field_values[M]) {\n            case 82:\n              this.extruder_coordinates_absolute = true;\n              break;\n            case 83:\n              this.extruder_coordinates_absolute = false;\n              break;\n          }\n        } else if (!isNaN(this.field_values[T])) {\n          this.instructions.addInstruction(\n            COMMANDS.TOOL_CHANGE,\n            this.field_values[T]\n          );\n          this.current_tool = this.field_values[T];\n          if (this.statistics.tools[this.current_tool] == undefined)\n            this.statistics.tools[this.current_tool] = { extrusion: 0 };\n        }\n\n        // reset all fields to NaN so that we don't use fields defined\n        // in previous commands if the current command does not have an optional\n        // field set\n        //\n        // this is faster than using \"field_values.fill(NaN)\" for some reason\n        for (let j = 0; j < 27; j++) {\n          this.field_values[j] = NaN;\n        }\n      } else if (c === CHAR_SEMICOLON) {\n        this.state = STATE_COMMENT;\n      }\n      this.prev_character = c;\n      this.byte_index += 1;\n    }\n    if (this.state === STATE_FIELD) {\n      this.last_block = data.slice(this.value_start);\n    }\n    //console.log((instruction_index * 4) / 1024 / 1024, instructions_f32);\n  }\n\n  pFloat(\n    data: Uint8Array,\n    data_start: number,\n    data_end: number,\n    dot_location: number\n  ) {\n    let result = 0;\n    let negative = false;\n\n    for (let i = data_start; i < data_end; ++i) {\n      let n = data[i] - 48;\n      if (i === data_start && data[i] === CHAR_MINUS) {\n        negative = true;\n      } else if (i < dot_location) {\n        result += n * LOOKUP_BEFORE_DOT[dot_location - i - 1];\n      } else if (i > dot_location)\n        result += n * LOOKUP_AFTER_DOT[i - dot_location - 1];\n    }\n    return negative ? -result : result;\n  }\n\n  getParsingResult() {\n    return {\n      instructions: this.instructions,\n      layerPositions: this.layer_positions,\n      layerHeights: this.layer_heights,\n      statistics: this.statistics,\n      lineIndex: [] //this.line_index\n    };\n  }\n}\n\nexport class Instructions {\n  blockSizeInInstructions: number;\n  buffers: ArrayBuffer[] = [];\n  currentBuffer = 0;\n  currentInstruction = 0;\n  currentFloat32Array: Float32Array;\n  totalInstructions = 0;\n\n  constructor(blockSizeInInstructions: number) {\n    this.blockSizeInInstructions = blockSizeInInstructions;\n    this.buffers.push(new ArrayBuffer(this.blockSizeInInstructions * 3 * 4));\n    this.currentFloat32Array = new Float32Array(\n      this.buffers[this.currentBuffer]\n    );\n  }\n\n  addInstruction(command: number, param1?: number, param2?: number) {\n    this.currentFloat32Array[this.currentInstruction * 3] = command;\n    if (param1 !== undefined)\n      this.currentFloat32Array[this.currentInstruction * 3 + 1] = param1;\n    if (param2 !== undefined)\n      this.currentFloat32Array[this.currentInstruction * 3 + 2] = param2;\n    this.currentInstruction += 1;\n    this.totalInstructions += 1;\n\n    if (this.currentInstruction >= this.blockSizeInInstructions) {\n      this.buffers.push(new ArrayBuffer(this.blockSizeInInstructions * 3 * 4));\n      this.currentBuffer += 1;\n      this.currentInstruction = 0;\n      this.currentFloat32Array = new Float32Array(\n        this.buffers[this.currentBuffer]\n      );\n    }\n  }\n}\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport * as React from \"react\";\nimport { Instructions, COMMANDS, IStatistics } from \"app/gcode-parser\";\nimport { zoom } from \"d3-zoom\";\nimport { select, event } from \"d3-selection\";\nimport { scaleLinear } from \"d3-scale\";\nimport { interpolateInferno } from \"d3-scale-chromatic\";\nimport { observer } from \"mobx-react-lite\";\nimport styled from \"styled-components\";\nimport { IGCode, IDrawSettings } from \"app/UIStore\";\nimport { action } from \"mobx\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { ResizeSensor } from \"@blueprintjs/core\";\n\nconst StyledCanvas = styled.canvas`\n  flex: 1;\n`;\n\nconst OverlayDiv = styled.div`\n  position: absolute;\n  padding: 5px;\n  background-color: transparent;\n`;\n\ninterface IProps {\n  currentLayer: number;\n  activeGCode: IGCode;\n  transform: ITransform;\n  setTransform: (newTransfrom: ITransform) => void;\n  drawSettings: IDrawSettings;\n}\n\nexport interface ITransform {\n  k: number;\n  x: number;\n  y: number;\n}\n\nconst GCodeViewer = observer(\n  ({\n    currentLayer,\n    activeGCode,\n    transform,\n    setTransform,\n    drawSettings\n  }: IProps) => {\n    const [context, setContext] = useState<CanvasRenderingContext2D | null>(\n      null\n    );\n\n    let canvas = useRef<HTMLCanvasElement>(null);\n\n    const doZoom = action(\"update transform\", () => {\n      /*const { k, x, y } = event.transform;\n      set(transform, \"x\", x);\n      set(transform, \"y\", y);\n      set(transform, \"k\", k);\n      transform.x = x;\n      transform.y = y;\n      transform.k = k;*/\n      //transform = { k, x, y };\n      setTransform(event.transform);\n    });\n\n    function draw() {\n      if (canvas.current === null || context === null || activeGCode === null) {\n        return;\n      }\n\n      clearCanvas(canvas.current, context);\n      drawInstructions(\n        context,\n        activeGCode.layerPositions[currentLayer],\n        activeGCode.layerPositions[currentLayer + 1],\n        activeGCode.instructions,\n        transform,\n        devicePixelRatio,\n        drawSettings,\n        activeGCode.statistics\n      );\n    }\n\n    function handleResize() {\n      if (canvas.current === null) return;\n\n      const currentHeight = canvas.current.clientHeight;\n      const currentWidth = canvas.current.clientWidth;\n      var devicePixelRatio = window.devicePixelRatio || 1;\n      if (\n        canvas.current.width !== currentWidth * devicePixelRatio ||\n        canvas.current.height !== currentHeight * devicePixelRatio\n      ) {\n        canvas.current.width = currentWidth * devicePixelRatio;\n        canvas.current.height = currentHeight * devicePixelRatio;\n      }\n      draw();\n    }\n\n    useEffect(() => {\n      if (context) {\n        draw();\n      } else {\n        if (canvas.current) setContext(canvas.current.getContext(\"2d\"));\n\n        const zoomBehaviour = zoom()\n          .on(\"zoom\", doZoom)\n          .scaleExtent([1, 128]);\n\n        if (canvas.current !== null)\n          zoomBehaviour(select(canvas.current as any));\n\n        //handleResize();\n      }\n    });\n\n    // hack to get mobx to notice we use this Observable\n    var tmp = drawSettings.lineWidth;\n    var tmp2 = drawSettings.coloringMode;\n    var tmp3 = drawSettings.scaleLinewidth;\n\n    return (\n      <ResizeSensor onResize={handleResize}>\n        <>\n          <OverlayDiv>\n            Layer {currentLayer}\n            <br />\n            Layer height: {activeGCode.layerHeights[currentLayer].toFixed(2)}\n          </OverlayDiv>\n          <StyledCanvas ref={canvas} />\n        </>\n      </ResizeSensor>\n    );\n  }\n);\nexport default GCodeViewer;\n\nfunction drawInstructions(\n  context: CanvasRenderingContext2D,\n  from: number,\n  to: number,\n  instructions: Instructions,\n  transform: any,\n  devicePixelRatio: number,\n  drawSettings: IDrawSettings,\n  statistics: IStatistics\n) {\n  const feedRateScale = scaleLinear()\n    .domain([\n      statistics.extruded_feed_rate.min,\n      statistics.extruded_feed_rate.max\n    ])\n    .range([0, 0.8]);\n\n  let prevX = 0;\n  let prevY = 0;\n\n  context.setTransform(\n    transform.k * devicePixelRatio,\n    0,\n    0,\n    transform.k * devicePixelRatio,\n    transform.x * devicePixelRatio,\n    transform.y * devicePixelRatio\n  );\n  if (drawSettings.scaleLinewidth) {\n    context.lineWidth = drawSettings.lineWidth / 50;\n  } else {\n    context.lineWidth = drawSettings.lineWidth / transform.k;\n  }\n\n  context.lineCap = \"round\";\n  context.beginPath();\n\n  const firstBuffer = Math.floor(from / instructions.blockSizeInInstructions);\n  const lastBuffer = Math.floor(to / instructions.blockSizeInInstructions);\n\n  let currentF32Buffer;\n  let command;\n  let param1, param2;\n\n  for (let i = firstBuffer; i <= lastBuffer; ++i) {\n    currentF32Buffer = new Float32Array(instructions.buffers[i]);\n\n    let offset = from - i * instructions.blockSizeInInstructions;\n    let end = to - i * instructions.blockSizeInInstructions;\n\n    for (let j = offset * 3; j < end * 3; j += 3) {\n      command = currentF32Buffer[j];\n      param1 = currentF32Buffer[j + 1];\n      param2 = currentF32Buffer[j + 2];\n\n      switch (command) {\n        case COMMANDS.MOVE_WITHOUT_EXTRUSION:\n          context.moveTo(param1, param2);\n          prevX = param1;\n          prevY = param2;\n          break;\n        case COMMANDS.MOVE_WITH_EXTRUSION:\n          context.lineTo(param1, param2);\n          prevX = param1;\n          prevY = param2;\n          break;\n        case COMMANDS.SET_FEED_RATE:\n          if (drawSettings.coloringMode === \"feed_rate\") {\n            context.stroke();\n            context.beginPath();\n            context.moveTo(prevX, prevY);\n            context.strokeStyle = interpolateInferno(feedRateScale(param1));\n          }\n          break;\n        case COMMANDS.TOOL_CHANGE:\n          if (drawSettings.coloringMode === \"tool\") {\n            context.stroke();\n            context.beginPath();\n            context.moveTo(prevX, prevY);\n\n            var color = drawSettings.toolColors[param1];\n            if (color) {\n              context.strokeStyle = color;\n            } else context.strokeStyle = \"grey\";\n          }\n          break;\n      }\n    }\n  }\n  context.stroke();\n\n  /*for (let i = from; i < to; ++i) {\n    let command = instructions.i8[i * 16];\n    let v1 = instructions.f32[i * 4 + 1];\n    let v2 = instructions.f32[i * 4 + 2];\n    if (command === 1) {\n      context.moveTo(v1, v2);\n      prevX = v1;\n      prevY = v2;\n    } else if (command === 2) {\n      context.lineTo(v1, v2);\n      prevX = v1;\n      prevY = v2;\n    } else if (command === 3) {\n      context.stroke();\n      context.beginPath();\n      context.moveTo(prevX, prevY);\n      context.strokeStyle = interpolateInferno(\n        feedRateScale(instructions.f32[i * 4 + 1])\n      );\n    }\n  }\n  context.stroke();*/\n}\n\nfunction clearCanvas(\n  canvas: HTMLCanvasElement,\n  context: CanvasRenderingContext2D\n) {\n  context.save();\n  context.setTransform(1, 0, 0, 1, 0, 0);\n  context.clearRect(0, 0, canvas.width, canvas.height);\n  context.restore();\n}\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport * as React from \"react\";\nimport { UIStore, IGCode } from \"app/UIStore\";\nimport GCodeViewer from \"./GCodeViewer\";\nimport { observer } from \"mobx-react-lite\";\n\ninterface IProps {\n  UIStore: UIStore;\n}\n\nconst LiveGCodeViewer = observer(\n  ({\n    UIStore: { activeGCode, transform, setTransform, drawSettings }\n  }: IProps) => {\n    if (\n      activeGCode &&\n      activeGCode.connection &&\n      activeGCode.connection.progress\n    ) {\n      const currentLine = getLineByBytePos(\n        activeGCode.connection.progress.filepos,\n        activeGCode\n      );\n      const from = findLayerByLine(activeGCode.layerPositions, currentLine);\n      const to = currentLine;\n      /*console.log(\n      \"LIVE\",\n      activeGCode.connection.progress.filepos,\n      currentLine,\n      from,\n      to\n    );*/\n      return (\n        <GCodeViewer\n          currentLayer={0} // Fix this\n          activeGCode={activeGCode}\n          transform={transform}\n          setTransform={setTransform}\n          drawSettings={drawSettings}\n        />\n      );\n    } else return <div>No GCode</div>;\n  }\n);\nexport default LiveGCodeViewer;\n\nfunction findLayerByLine(layerPositions: number[], currentLine: number) {\n  for (let i = 0; i < layerPositions.length; ++i) {\n    if (layerPositions[i] > currentLine) {\n      return layerPositions[i - 1];\n    }\n  }\n  return layerPositions.length;\n}\n\nfunction getLineByBytePos(bytepos: number, activeGCode: IGCode) {\n  for (let i = 0; i < activeGCode.lineIndex.length; ++i) {\n    if (activeGCode.lineIndex[i] > bytepos) {\n      return i;\n    }\n  }\n  return activeGCode.lineIndex.length;\n}\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport GCodeParser from \"./gcode-parser\";\nimport { IGCode } from \"./UIStore\";\n\nexport function uploadGCodeFiles(files: FileList): Promise<IGCode> {\n  return new Promise((resolve, reject) => {\n    let file: File = files[0];\n    const reader = new FileReader();\n    let offset = 0;\n\n    const parser = new GCodeParser();\n    const t0 = performance.now();\n\n    function readSlice() {\n      let s = file.slice(offset, offset + 1024 * 1024);\n      reader.readAsArrayBuffer(s);\n    }\n\n    reader.onload = () => {\n      parser.parse(reader.result as ArrayBuffer);\n      offset += 1024 * 1024;\n      if (offset < file.size) readSlice();\n      else {\n        const delta = performance.now() - t0;\n        const fileSizeMB = file.size / 1024 / 1024;\n\n        console.log(\n          `Read ${fileSizeMB.toFixed(2)} megabytes in ${delta.toFixed(\n            0\n          )} ms. ${(delta / fileSizeMB).toFixed(0)} ms/megabyte ${(\n            1000 /\n            (delta / fileSizeMB)\n          ).toFixed(1)} megabyte/s`\n        );\n        const parsingResult = parser.getParsingResult();\n        resolve({\n          name: file.name,\n          numberOfLayers: parsingResult.layerPositions.length,\n          ...parsingResult\n        });\n      }\n    };\n    readSlice();\n  });\n}\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport React, { useCallback } from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport styled from \"styled-components\";\nimport { uploadGCodeFiles } from \"app/file-upload\";\nimport UIStore from \"app/UIStore\";\n\nconst DropzoneContainer = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  padding: 20px;\n  margin: 10px;\n  border-width: 4px;\n  border-radius: 2px;\n  border-color: #bbb;\n  border-style: dashed;\n  background-color: #fafafa;\n  color: #666;\n  font-size: 300%;\n  font-weight: bold;\n`;\n\nconst CenteredParagraph = styled.p`\n  text-align: center;\n`;\n\ninterface IProps {\n  onFileLoad: () => void;\n}\n\nexport function GCodeDropzone({ onFileLoad }: IProps) {\n  const onDrop = useCallback(async acceptedFiles => {\n    UIStore.setActiveGCode(null);\n    const gcode = await uploadGCodeFiles(acceptedFiles);\n    UIStore.setActiveGCode(gcode);\n    if (onFileLoad) onFileLoad();\n  }, []);\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({ onDrop });\n\n  return (\n    <DropzoneContainer {...getRootProps()}>\n      <input {...getInputProps()} />\n      {isDragActive ? (\n        <p>Drop the files here ...</p>\n      ) : (\n        <CenteredParagraph>\n          Drag a G-Code file here\n          <br /> or <br /> click to select a file\n        </CenteredParagraph>\n      )}\n    </DropzoneContainer>\n  );\n}\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport * as React from \"react\";\nimport { UIStore } from \"app/UIStore\";\nimport GCodeViewer from \"./GCodeViewer\";\nimport { observer } from \"mobx-react-lite\";\nimport { GCodeDropzone } from \"./GCodeDropzone\";\nimport { useState } from \"react\";\nimport styled from \"styled-components\";\n\ninterface IProps {\n  UIStore: UIStore;\n}\nconst StyledDiv = styled.div`\n  flex: 1;\n  display: flex;\n`;\n\nconst StaticGCodeViewer = observer(\n  ({\n    UIStore: { activeGCode, activeLayer, transform, setTransform, drawSettings }\n  }: IProps) => {\n    const [isDragging, setDragging] = useState<boolean>(false);\n\n    function handleDragOver(e: any) {\n      setDragging(true);\n    }\n\n    function handleDragLeave(e: any) {\n      setDragging(false);\n    }\n\n    if (activeGCode && !isDragging) {\n      return (\n        <StyledDiv onDragOver={handleDragOver} onDragLeave={handleDragLeave}>\n          <GCodeViewer\n            currentLayer={activeLayer}\n            activeGCode={activeGCode}\n            transform={transform}\n            setTransform={setTransform}\n            drawSettings={drawSettings}\n          />\n        </StyledDiv>\n      );\n    } else return <GCodeDropzone onFileLoad={() => setDragging(false)} />;\n  }\n);\nexport default StaticGCodeViewer;\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport * as React from \"react\";\nimport {\n  Button,\n  Drawer,\n  Classes,\n  NumericInput,\n  FormGroup,\n  RadioGroup,\n  Radio,\n  Checkbox\n} from \"@blueprintjs/core\";\nimport { useState } from \"react\";\nimport { IDrawSettings } from \"app/UIStore\";\nimport { observer } from \"mobx-react-lite\";\nimport { action } from \"mobx\";\n\ninterface IDrawSettingsButtonProps {\n  drawSettings: IDrawSettings;\n  setDrawSetting: (setting: keyof IDrawSettings, value: any) => void;\n}\n\nconst DrawSettingsButton = observer((props: IDrawSettingsButtonProps) => {\n  const [isOpen, setOpen] = useState(false);\n\n  return (\n    <>\n      <Button\n        className=\"bp3-minimal\"\n        icon=\"cog\"\n        text=\"Draw settings\"\n        onClick={() => setOpen(true)}\n      />\n      <SettingsDrawer\n        isOpen={isOpen}\n        handleClose={() => setOpen(false)}\n        {...props}\n      />\n    </>\n  );\n});\nexport default DrawSettingsButton;\n\nconst SettingsDrawer = observer(\n  ({\n    isOpen,\n    handleClose,\n    ...props\n  }: {\n    isOpen: boolean;\n    handleClose: () => void;\n    drawSettings: IDrawSettings;\n    setDrawSetting: (setting: keyof IDrawSettings, value: any) => void;\n  }) => {\n    return (\n      <Drawer\n        isOpen={isOpen}\n        icon=\"cog\"\n        size=\"20%\"\n        hasBackdrop={false}\n        onClose={handleClose}\n        title=\"Draw Settings\"\n      >\n        <div className={Classes.DRAWER_BODY}>\n          <div className={Classes.DIALOG_BODY}>\n            <DrawSettings {...props} />\n          </div>\n        </div>\n      </Drawer>\n    );\n  }\n);\n\nconst DrawSettings = observer(({ drawSettings }: IDrawSettingsButtonProps) => {\n  return (\n    <div>\n      <FormGroup label=\"Linewidth\" labelFor=\"linewidth-input\">\n        <NumericInput\n          value={drawSettings.lineWidth}\n          id=\"linewidth-input\"\n          onValueChange={action(\n            \"set line width\",\n            (newValue: any) => (drawSettings.lineWidth = newValue)\n          )}\n        />\n      </FormGroup>\n      <Checkbox\n        checked={drawSettings.scaleLinewidth}\n        label=\"Scale linewidth with zoom\"\n        onChange={action(\n          \"set line width scaling\",\n          (newValue: any) =>\n            (drawSettings.scaleLinewidth = newValue.target.checked)\n        )}\n      />\n      <RadioGroup\n        label=\"Coloring mode\"\n        selectedValue={drawSettings.coloringMode}\n        onChange={action(\"set coloring mode\", (changeEvent: any) => {\n          drawSettings.coloringMode = changeEvent.target.value;\n        })}\n      >\n        <Radio label=\"by feed rate\" value=\"feed_rate\" />\n        <Radio label=\"by tool\" value=\"tool\" />\n      </RadioGroup>\n    </div>\n  );\n});\n","import * as React from \"react\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { useState } from \"react\";\r\nimport { Button, Dialog, Classes, HTMLTable } from \"@blueprintjs/core\";\r\nimport { IStatistics } from \"app/gcode-parser\";\r\n\r\n/* \r\nCopyright 2019 Fabian Hiller\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License. \r\n*/\r\n\r\nconst StatisticsModal = observer(\r\n  ({ statistics }: { statistics: IStatistics }) => {\r\n    const [isOpen, setOpen] = useState(false);\r\n\r\n    return (\r\n      <>\r\n        <Button\r\n          className=\"bp3-minimal\"\r\n          text=\"Statistics\"\r\n          icon=\"timeline-bar-chart\"\r\n          onClick={() => setOpen(true)}\r\n        />\r\n        <Dialog\r\n          isOpen={isOpen}\r\n          icon=\"timeline-bar-chart\"\r\n          title=\"Statistics\"\r\n          onClose={() => setOpen(false)}\r\n        >\r\n          <div className={Classes.DIALOG_BODY}>\r\n            <h2>Dimensions</h2>\r\n            <p>\r\n              {(statistics.x.max - statistics.x.min).toFixed(2)}&nbsp;x&nbsp;\r\n              {(statistics.y.max - statistics.y.min).toFixed(2)}&nbsp;x&nbsp;\r\n              {(statistics.z.max - statistics.z.min).toFixed(2)}&nbsp;mm\r\n            </p>\r\n            <h2>Feed rate</h2>\r\n            <p>\r\n              {statistics.feed_rate.min.toFixed(0)} -{\" \"}\r\n              {statistics.feed_rate.max.toFixed(0)} feed rate\r\n            </p>\r\n            <p>\r\n              {statistics.extruded_feed_rate.min.toFixed(0)} -{\" \"}\r\n              {statistics.extruded_feed_rate.max.toFixed(0)} feed rate while\r\n              extruding\r\n            </p>\r\n            <h2>Tool overview</h2>\r\n            <ToolTable statistics={statistics} />\r\n          </div>\r\n        </Dialog>\r\n      </>\r\n    );\r\n  }\r\n);\r\nexport default StatisticsModal;\r\n\r\nfunction ToolTable({ statistics }: { statistics: IStatistics }) {\r\n  return (\r\n    <HTMLTable bordered={true} condensed={true}>\r\n      <thead>\r\n        <tr>\r\n          <th>tool</th>\r\n          <th>extrusion</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {statistics.tools.map((tool, index) => (\r\n          <tr>\r\n            <td>{index}</td>\r\n            <td>{tool.extrusion.toFixed(2)} mm</td>\r\n          </tr>\r\n        ))}\r\n      </tbody>\r\n    </HTMLTable>\r\n  );\r\n}\r\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport { FocusStyleManager } from \"@blueprintjs/core\";\n\nimport \"normalize.css/normalize.css\";\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\n\nimport * as React from \"react\";\nimport { FormGroup, Navbar, Alignment } from \"@blueprintjs/core\";\n\nimport styled from \"styled-components\";\nimport { Slider } from \"@blueprintjs/core\";\nimport { observer } from \"mobx-react-lite\";\nimport UIStore from \"app/UIStore\";\n\nimport LiveGCodeViewer from \"./LiveGCodeViewer\";\nimport StaticGCodeViewer from \"./StaticGCodeViewer\";\nimport DrawSettingsButton from \"./DrawSettings\";\n\nimport Statistics from \"./Statistics\";\n\n// See https://blueprintjs.com/docs/#core/accessibility.focus-management\nFocusStyleManager.onlyShowFocusOnTabs();\n\nconst GridContainer = styled.div`\n  background: #eee;\n  display: grid;\n  grid-template-columns: 200px minmax(0, 1fr);\n  grid-template-rows: auto minmax(0, 1fr) auto;\n  width: 100vw;\n  height: 100vh;\n  align-self: stretch;\n  overflow: hidden;\n`;\n\nconst TopbarContainer = styled.div`\n  grid-column: 1/3;\n  grid-row: 1;\n  gap: 0;\n`;\n\nconst ViewerContainer = styled.div`\n  grid-column: 1/3;\n  grid-row: 2;\n  background: white;\n  display: flex;\n`;\n\nconst ToolContainer = styled.div`\n  grid-column: 1/3;\n  grid-row: 3;\n  padding: 0 20px 0 20px;\n`;\n\ninterface IProps {}\n\nconst App = observer(IProps => {\n  return (\n    //<React.StrictMode>\n    <GridContainer>\n      <TopbarContainer>\n        <Navbar className=\"bp3-dark\">\n          <Navbar.Group align={Alignment.LEFT}>\n            <Navbar.Heading>G-Code viewer for 3D printing</Navbar.Heading>\n            <Navbar.Divider />\n\n            <DrawSettingsButton\n              drawSettings={UIStore.drawSettings}\n              setDrawSetting={UIStore.setDrawSetting}\n            />\n            {UIStore.activeGCode && (\n              <Statistics statistics={UIStore.activeGCode.statistics} />\n            )}\n          </Navbar.Group>\n        </Navbar>\n      </TopbarContainer>\n\n      <ViewerContainer>\n        {UIStore.trackProgress ? (\n          <LiveGCodeViewer UIStore={UIStore} />\n        ) : (\n          <StaticGCodeViewer UIStore={UIStore} />\n        )}\n      </ViewerContainer>\n      {UIStore.activeGCode ? (\n        <ToolContainer>\n          <FormGroup label=\"Current layer\">\n            <Slider\n              value={UIStore.activeLayer}\n              min={0}\n              max={\n                UIStore.numberOfLayers !== 0 ? UIStore.numberOfLayers - 2 : 100\n              }\n              disabled={UIStore.numberOfLayers === 0}\n              labelStepSize={Math.ceil(1 + UIStore.numberOfLayers / 200) * 10}\n              onChange={n => UIStore.setActiveLayer(n)}\n            />\n          </FormGroup>\n        </ToolContainer>\n      ) : null}\n    </GridContainer>\n    //</React.StrictMode>\n  );\n});\nexport default App;\n","/* \nCopyright 2019 Fabian Hiller\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License. \n*/\n\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport App from \"./components/App\";\n\nReactDOM.render(<App />, document.getElementById(\"main\"));\n"],"sourceRoot":""}