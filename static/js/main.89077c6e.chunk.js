(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{64:function(e,t,i){e.exports=i(83)},83:function(e,t,i){"use strict";i.r(t);var r,n,a,s,o,c,l,u,h,d=i(0),f=i.n(d),_=i(17),v=i(18),m=i(94),b=(i(69),i(70),i(93)),p=i(25),y=i(87),g=i(19),O=i(92),x=i(16),E=i(27),w=i(29),j=i(30),I=i(22),C=(i(71),i(11)),k=new(r=C.b.bound,n=C.b.bound,a=C.e.ref,s=function(){function e(){Object(w.a)(this,e),Object(E.a)(this,"transform",o,this),Object(E.a)(this,"activeLayer",c,this),Object(E.a)(this,"trackProgress",l,this),Object(E.a)(this,"drawSettings",u,this),Object(E.a)(this,"activeGCode",h,this)}return Object(j.a)(e,[{key:"setDrawSetting",value:function(e,t){}},{key:"setActiveLayer",value:function(e){this.activeLayer=e}},{key:"setTransform",value:function(e){this.transform=e}},{key:"setActiveGCode",value:function(e){this.activeGCode=e,this.activeLayer=1}},{key:"numberOfLayers",get:function(){return null===this.activeGCode?0:this.activeGCode.numberOfLayers}}]),e}(),o=Object(I.a)(s.prototype,"transform",[C.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{k:1,x:0,y:0}}}),c=Object(I.a)(s.prototype,"activeLayer",[C.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(I.a)(s.prototype,"trackProgress",[C.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=Object(I.a)(s.prototype,"drawSettings",[C.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{lineWidth:8,coloringMode:"feed_rate",toolColors:["blue","green","red","orange","black"],scaleLinewidth:!0}}}),Object(I.a)(s.prototype,"setDrawSetting",[r],Object.getOwnPropertyDescriptor(s.prototype,"setDrawSetting"),s.prototype),Object(I.a)(s.prototype,"numberOfLayers",[C.c],Object.getOwnPropertyDescriptor(s.prototype,"numberOfLayers"),s.prototype),Object(I.a)(s.prototype,"setActiveLayer",[C.b],Object.getOwnPropertyDescriptor(s.prototype,"setActiveLayer"),s.prototype),Object(I.a)(s.prototype,"setTransform",[n],Object.getOwnPropertyDescriptor(s.prototype,"setTransform"),s.prototype),Object(I.a)(s.prototype,"setActiveGCode",[C.b],Object.getOwnPropertyDescriptor(s.prototype,"setActiveGCode"),s.prototype),h=Object(I.a)(s.prototype,"activeGCode",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s),A=i(23),S=0,T="0".charCodeAt(0),N="9".charCodeAt(0),L=".".charCodeAt(0),F="-".charCodeAt(0),z=" ".charCodeAt(0),D="\t".charCodeAt(0),G="A".charCodeAt(0),R="Z".charCodeAt(0),P="\n".charCodeAt(0),H="\r".charCodeAt(0),U=";".charCodeAt(0),W={MOVE_WITH_EXTRUSION:1,MOVE_WITHOUT_EXTRUSION:2,SET_FEED_RATE:3,RETRACTION:4,LAYER_CHANGE:5,TOOL_CHANGE:6},M=32768,B=[1,10,100,1e3,1e4,1e5,1e6],V=[.1,.01,.001,1e-4,1e-5,1e-6],X=function(){function e(){Object(w.a)(this,e),this.state=S,this.field=0,this.value_start=void 0,this.dot_position=void 0,this.prev_character=void 0,this.field_values=new Float32Array(27),this.axis_coordinates_absolute=!0,this.extruder_coordinates_absolute=!1,this.feed_rate=0,this.current_tool=0,this.prev_z=0,this.last_z_with_extrusion=void 0,this.last_feed_rate_with_extrusion=void 0,this.current_layer_index=0,this.layer_positions=[],this.layer_heights=[],this.prev_x=0,this.prev_y=0,this.prev_e=0,this.instructions=new Y(M),this.byte_index=0,this.last_block=void 0,this.statistics={x:{min:1/0,max:-1/0},y:{min:1/0,max:-1/0},z:{min:0,max:-1/0},feed_rate:{min:1/0,max:-1/0},extruded_feed_rate:{min:1/0,max:-1/0},tools:[{extrusion:0}]},this.field_values.fill(NaN)}return Object(j.a)(e,[{key:"parse",value:function(e){for(var t,i=new Uint8Array(e),r=0;r<i.length;++r){if((t=i[r])>=T&&t<=N||t===L||t===F)t===L&&(this.dot_position=r);else if(t===z||t===D){if(1===this.state&&this.value_start){if(void 0!==this.last_block){for(var n=new Uint8Array(Array.from(this.last_block).concat(Array.from(i.slice(0,r)))),a=n.length,s=0;s<n.length;++s)n[s]===L&&(a=s);this.field_values[this.field-65]=this.pFloat(n,0,n.length,a),this.last_block=void 0}else this.field_values[this.field-65]=this.pFloat(i,this.value_start,r,this.dot_position?this.dot_position:r);this.value_start=void 0,this.dot_position=void 0,this.state=S}}else if(t>=G&&t<=R)this.state===S&&(this.field=i[r],this.state=1,this.value_start=r+1);else if(t!==H&&t!==P||this.prev_character===H||this.prev_character===P)t===U&&(this.state=2);else{if(this.value_start&&(this.field_values[this.field-65]=this.pFloat(i,this.value_start,r,this.dot_position?this.dot_position:r)),this.state=S,this.value_start=void 0,this.dot_position=void 0,isNaN(this.field_values[6]))if(isNaN(this.field_values[12]))isNaN(this.field_values[19])||(this.instructions.addInstruction(W.TOOL_CHANGE,this.field_values[19]),this.current_tool=this.field_values[19],void 0==this.statistics.tools[this.current_tool]&&(this.statistics.tools[this.current_tool]={extrusion:0}));else switch(this.field_values[12]){case 82:this.extruder_coordinates_absolute=!0;break;case 83:this.extruder_coordinates_absolute=!1}else switch(this.field_values[6]){case 0:case 1:var o,c,l;if(!isNaN(this.field_values[23])||!isNaN(this.field_values[24]))!isNaN(this.field_values[4])&&(this.extruder_coordinates_absolute&&this.field_values[4]>this.prev_e||!this.extruder_coordinates_absolute&&this.field_values[4]>0)?(this.prev_z!==this.last_z_with_extrusion&&(this.instructions.addInstruction(W.LAYER_CHANGE,this.prev_z),this.layer_positions.push(this.instructions.totalInstructions),this.layer_heights.push(this.prev_z),this.current_layer_index+=1,this.prev_z>this.statistics.z.max&&(this.statistics.z.max=this.prev_z),this.instructions.addInstruction(W.MOVE_WITHOUT_EXTRUSION,this.prev_x,this.prev_y),this.instructions.addInstruction(W.SET_FEED_RATE,this.feed_rate),this.instructions.addInstruction(W.TOOL_CHANGE,this.current_tool)),o=W.MOVE_WITH_EXTRUSION,this.last_z_with_extrusion=this.prev_z,this.feed_rate!==this.last_feed_rate_with_extrusion&&(this.feed_rate>this.statistics.extruded_feed_rate.max&&(this.statistics.extruded_feed_rate.max=this.feed_rate),this.feed_rate<this.statistics.extruded_feed_rate.min&&(this.statistics.extruded_feed_rate.min=this.feed_rate)),this.last_feed_rate_with_extrusion=this.feed_rate,this.statistics.tools[this.current_tool].extrusion+=this.field_values[4]):o=W.MOVE_WITHOUT_EXTRUSION,isNaN(this.field_values[23])?c=this.prev_x:((c=this.axis_coordinates_absolute?this.field_values[23]:this.prev_x+this.field_values[23])>this.statistics.x.max&&(this.statistics.x.max=c),c<this.statistics.x.min&&(this.statistics.x.min=c)),isNaN(this.field_values[24])?l=this.prev_y:((l=this.axis_coordinates_absolute?this.field_values[24]:this.prev_y+this.field_values[24])>this.statistics.y.max&&(this.statistics.y.max=l),l<this.statistics.y.min&&(this.statistics.y.min=l)),this.instructions.addInstruction(o,c,l),this.prev_x=c,this.prev_y=l;isNaN(this.field_values[5])||(this.feed_rate=this.field_values[5],this.instructions.addInstruction(W.SET_FEED_RATE,this.field_values[5]),this.feed_rate>this.statistics.feed_rate.max&&(this.statistics.feed_rate.max=this.feed_rate),this.feed_rate<this.statistics.feed_rate.min&&(this.statistics.feed_rate.min=this.feed_rate)),isNaN(this.field_values[25])||(this.field_values[25]>this.prev_z&&this.instructions.addInstruction(W.RETRACTION),this.prev_z=this.field_values[25]);break;case 90:this.axis_coordinates_absolute=!0;break;case 91:this.axis_coordinates_absolute=!1}for(var u=0;u<27;u++)this.field_values[u]=NaN}this.prev_character=t,this.byte_index+=1}1===this.state&&(this.last_block=i.slice(this.value_start))}},{key:"pFloat",value:function(e,t,i,r){for(var n=0,a=!1,s=t;s<i;++s){var o=e[s]-48;s===t&&e[s]===F?a=!0:s<r?n+=o*B[r-s-1]:s>r&&(n+=o*V[s-r-1])}return a?-n:n}},{key:"getParsingResult",value:function(){return{instructions:this.instructions,layerPositions:this.layer_positions,layerHeights:this.layer_heights,statistics:this.statistics,lineIndex:[]}}}]),e}(),Y=function(){function e(t){Object(w.a)(this,e),this.blockSizeInInstructions=void 0,this.buffers=[],this.currentBuffer=0,this.currentInstruction=0,this.currentFloat32Array=void 0,this.totalInstructions=0,this.blockSizeInInstructions=t,this.buffers.push(new ArrayBuffer(3*this.blockSizeInInstructions*4)),this.currentFloat32Array=new Float32Array(this.buffers[this.currentBuffer])}return Object(j.a)(e,[{key:"addInstruction",value:function(e,t,i){this.currentFloat32Array[3*this.currentInstruction]=e,void 0!==t&&(this.currentFloat32Array[3*this.currentInstruction+1]=t),void 0!==i&&(this.currentFloat32Array[3*this.currentInstruction+2]=i),this.currentInstruction+=1,this.totalInstructions+=1,this.currentInstruction>=this.blockSizeInInstructions&&(this.buffers.push(new ArrayBuffer(3*this.blockSizeInInstructions*4)),this.currentBuffer+=1,this.currentInstruction=0,this.currentFloat32Array=new Float32Array(this.buffers[this.currentBuffer]))}}]),e}(),J=i(54),Z=i(3),q=i(53),K=i(55),Q=i(85);function $(){var e=Object(v.a)(["\n  position: absolute;\n  padding: 5px;\n  background-color: transparent;\n"]);return $=function(){return e},e}function ee(){var e=Object(v.a)(["\n  flex: 1;\n"]);return ee=function(){return e},e}var te=g.a.canvas(ee()),ie=g.a.div($()),re=Object(x.a)(function(e){var t=e.currentLayer,i=e.activeGCode,r=e.transform,n=e.setTransform,a=e.drawSettings,s=Object(d.useState)(null),o=Object(A.a)(s,2),c=o[0],l=o[1],u=Object(d.useRef)(null),h=Object(C.b)("update transform",function(){n(Z.b.transform)});function f(){null!==u.current&&null!==c&&null!==i&&(function(e,t){t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.restore()}(u.current,c),function(e,t,i,r,n,a,s,o){var c=Object(q.a)().domain([o.extruded_feed_rate.min,o.extruded_feed_rate.max]).range([0,.8]),l=0,u=0;e.setTransform(n.k*a,0,0,n.k*a,n.x*a,n.y*a),s.scaleLinewidth?e.lineWidth=s.lineWidth/50:e.lineWidth=s.lineWidth/n.k;e.lineCap="round",e.beginPath();for(var h,d,f,_,v=Math.floor(t/r.blockSizeInInstructions),m=Math.floor(i/r.blockSizeInInstructions),b=v;b<=m;++b){h=new Float32Array(r.buffers[b]);for(var p=t-b*r.blockSizeInInstructions,y=i-b*r.blockSizeInInstructions,g=3*p;g<3*y;g+=3)switch(d=h[g],f=h[g+1],_=h[g+2],d){case W.MOVE_WITHOUT_EXTRUSION:e.moveTo(f,_),l=f,u=_;break;case W.MOVE_WITH_EXTRUSION:e.lineTo(f,_),l=f,u=_;break;case W.SET_FEED_RATE:"feed_rate"===s.coloringMode&&(e.stroke(),e.beginPath(),e.moveTo(l,u),e.strokeStyle=Object(K.a)(c(f)));break;case W.TOOL_CHANGE:if("tool"===s.coloringMode){e.stroke(),e.beginPath(),e.moveTo(l,u);var O=s.toolColors[f];e.strokeStyle=O||"grey"}}}e.stroke()}(c,i.layerPositions[t],i.layerPositions[t+1],i.instructions,r,devicePixelRatio,a,i.statistics))}Object(d.useEffect)(function(){if(c)f();else{u.current&&l(u.current.getContext("2d"));var e=Object(J.a)().on("zoom",h).scaleExtent([1,128]);null!==u.current&&e(Object(Z.f)(u.current))}});a.lineWidth,a.coloringMode,a.scaleLinewidth;return d.createElement(Q.a,{onResize:function(){if(null!==u.current){var e=u.current.clientHeight,t=u.current.clientWidth,i=window.devicePixelRatio||1;u.current.width===t*i&&u.current.height===e*i||(u.current.width=t*i,u.current.height=e*i),f()}}},d.createElement(d.Fragment,null,d.createElement(ie,null,"Layer ",t,d.createElement("br",null),"Layer height: ",i.layerHeights[t].toFixed(2)),d.createElement(te,{ref:u})))});var ne=Object(x.a)(function(e){var t=e.UIStore,i=t.activeGCode,r=t.transform,n=t.setTransform,a=t.drawSettings;if(i&&i.connection&&i.connection.progress){var s=function(e,t){for(var i=0;i<t.lineIndex.length;++i)if(t.lineIndex[i]>e)return i;return t.lineIndex.length}(i.connection.progress.filepos,i);(function(e,t){for(var i=0;i<e.length;++i)if(e[i]>t)return e[i-1];e.length})(i.layerPositions,s);return d.createElement(re,{currentLayer:0,activeGCode:i,transform:r,setTransform:n,drawSettings:a})}return d.createElement("div",null,"No GCode")});var ae=i(39),se=i.n(ae),oe=i(51),ce=i(56),le=i(60);function ue(e){return new Promise(function(t,i){var r=e[0],n=new FileReader,a=0,s=new X,o=performance.now();function c(){var e=r.slice(a,a+1048576);n.readAsArrayBuffer(e)}n.onload=function(){if(s.parse(n.result),(a+=1048576)<r.size)c();else{var e=performance.now()-o,i=r.size/1024/1024;console.log("Read ".concat(i.toFixed(2)," megabytes in ").concat(e.toFixed(0)," ms. ").concat((e/i).toFixed(0)," ms/megabyte ").concat((1e3/(e/i)).toFixed(1)," megabyte/s"));var l=s.getParsingResult();t(Object(le.a)({name:r.name,numberOfLayers:l.layerPositions.length},l))}},c()})}function he(){var e=Object(v.a)(["\n  text-align: center;\n"]);return he=function(){return e},e}function de(){var e=Object(v.a)(["\n  flex: 1;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  padding: 20px;\n  margin: 10px;\n  border-width: 4px;\n  border-radius: 2px;\n  border-color: #bbb;\n  border-style: dashed;\n  background-color: #fafafa;\n  color: #666;\n  font-size: 300%;\n  font-weight: bold;\n"]);return de=function(){return e},e}var fe=g.a.div(de()),_e=g.a.p(he());function ve(e){var t=e.onFileLoad,i=Object(d.useCallback)(function(){var e=Object(oe.a)(se.a.mark(function e(i){var r;return se.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k.setActiveGCode(null),e.next=3,ue(i);case 3:r=e.sent,k.setActiveGCode(r),t&&t();case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[]),r=Object(ce.a)({onDrop:i}),n=r.getRootProps,a=r.getInputProps,s=r.isDragActive;return f.a.createElement(fe,n(),f.a.createElement("input",a()),s?f.a.createElement("p",null,"Drop the files here ..."):f.a.createElement(_e,null,"Drag a G-Code file here",f.a.createElement("br",null)," or ",f.a.createElement("br",null)," click to select a file"))}function me(){var e=Object(v.a)(["\n  flex: 1;\n  display: flex;\n"]);return me=function(){return e},e}var be=g.a.div(me()),pe=Object(x.a)(function(e){var t=e.UIStore,i=t.activeGCode,r=t.activeLayer,n=t.transform,a=t.setTransform,s=t.drawSettings,o=Object(d.useState)(!1),c=Object(A.a)(o,2),l=c[0],u=c[1];return i&&!l?d.createElement(be,{onDragOver:function(e){u(!0)},onDragLeave:function(e){u(!1)}},d.createElement(re,{currentLayer:r,activeGCode:i,transform:n,setTransform:a,drawSettings:s})):d.createElement(ve,{onFileLoad:function(){return u(!1)}})}),ye=i(59),ge=i(26),Oe=i(86),xe=i(8),Ee=i(91),we=i(40),je=i(88),Ie=Object(x.a)(function(e){var t=Object(d.useState)(!1),i=Object(A.a)(t,2),r=i[0],n=i[1];return d.createElement(d.Fragment,null,d.createElement(ge.a,{className:"bp3-minimal",icon:"cog",text:"Draw settings",onClick:function(){return n(!0)}}),d.createElement(Ce,Object.assign({isOpen:r,handleClose:function(){return n(!1)}},e)))}),Ce=Object(x.a)(function(e){var t=e.isOpen,i=e.handleClose,r=Object(ye.a)(e,["isOpen","handleClose"]);return d.createElement(Oe.a,{isOpen:t,icon:"cog",size:"20%",hasBackdrop:!1,onClose:i,title:"Draw Settings"},d.createElement("div",{className:xe.a.DRAWER_BODY},d.createElement("div",{className:xe.a.DIALOG_BODY},d.createElement(ke,r))))}),ke=Object(x.a)(function(e){var t=e.drawSettings;return d.createElement("div",null,d.createElement(y.a,{label:"Linewidth",labelFor:"linewidth-input"},d.createElement(Ee.a,{value:t.lineWidth,id:"linewidth-input",onValueChange:Object(C.b)("set line width",function(e){return t.lineWidth=e})})),d.createElement(we.a,{checked:t.scaleLinewidth,label:"Scale linewidth with zoom",onChange:Object(C.b)("set line width scaling",function(e){return t.scaleLinewidth=e.target.checked})}),d.createElement(je.a,{label:"Coloring mode",selectedValue:t.coloringMode,onChange:Object(C.b)("set coloring mode",function(e){t.coloringMode=e.target.value})},d.createElement(we.b,{label:"by feed rate",value:"feed_rate"}),d.createElement(we.b,{label:"by tool",value:"tool"})))}),Ae=i(89),Se=i(90),Te=Object(x.a)(function(e){var t=e.statistics,i=Object(d.useState)(!1),r=Object(A.a)(i,2),n=r[0],a=r[1];return d.createElement(d.Fragment,null,d.createElement(ge.a,{className:"bp3-minimal",text:"Statistics",icon:"timeline-bar-chart",onClick:function(){return a(!0)}}),d.createElement(Ae.a,{isOpen:n,icon:"timeline-bar-chart",title:"Statistics",onClose:function(){return a(!1)}},d.createElement("div",{className:xe.a.DIALOG_BODY},d.createElement("h2",null,"Dimensions"),d.createElement("p",null,(t.x.max-t.x.min).toFixed(2),"\xa0x\xa0",(t.y.max-t.y.min).toFixed(2),"\xa0x\xa0",(t.z.max-t.z.min).toFixed(2),"\xa0mm"),d.createElement("h2",null,"Feed rate"),d.createElement("p",null,t.feed_rate.min.toFixed(0)," -"," ",t.feed_rate.max.toFixed(0)," feed rate"),d.createElement("p",null,t.extruded_feed_rate.min.toFixed(0)," -"," ",t.extruded_feed_rate.max.toFixed(0)," feed rate while extruding"),d.createElement("h2",null,"Tool overview"),d.createElement(Ne,{statistics:t}))))});function Ne(e){var t=e.statistics;return d.createElement(Se.a,{bordered:!0,condensed:!0},d.createElement("thead",null,d.createElement("tr",null,d.createElement("th",null,"tool"),d.createElement("th",null,"extrusion"))),d.createElement("tbody",null,t.tools.map(function(e,t){return d.createElement("tr",null,d.createElement("td",null,t),d.createElement("td",null,e.extrusion.toFixed(2)," mm"))})))}function Le(){var e=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 3;\n  padding: 0 20px 0 20px;\n"]);return Le=function(){return e},e}function Fe(){var e=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 2;\n  background: white;\n  display: flex;\n"]);return Fe=function(){return e},e}function ze(){var e=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 1;\n  gap: 0;\n"]);return ze=function(){return e},e}function De(){var e=Object(v.a)(["\n  background: #eee;\n  display: grid;\n  grid-template-columns: 200px minmax(0, 1fr);\n  grid-template-rows: auto minmax(0, 1fr) auto;\n  width: 100vw;\n  height: 100vh;\n  align-self: stretch;\n  overflow: hidden;\n"]);return De=function(){return e},e}m.a.onlyShowFocusOnTabs();var Ge=g.a.div(De()),Re=g.a.div(ze()),Pe=g.a.div(Fe()),He=g.a.div(Le()),Ue=Object(x.a)(function(e){return d.createElement(Ge,null,d.createElement(Re,null,d.createElement(b.a,{className:"bp3-dark"},d.createElement(b.a.Group,{align:p.a.LEFT},d.createElement(b.a.Heading,null,"G-Code viewer for 3D printing"),d.createElement(b.a.Divider,null),d.createElement(Ie,{drawSettings:k.drawSettings,setDrawSetting:k.setDrawSetting}),k.activeGCode&&d.createElement(Te,{statistics:k.activeGCode.statistics})))),d.createElement(Pe,null,k.trackProgress?d.createElement(ne,{UIStore:k}):d.createElement(pe,{UIStore:k})),k.activeGCode?d.createElement(He,null,d.createElement(y.a,{label:"Current layer"},d.createElement(O.a,{value:k.activeLayer,min:0,max:0!==k.numberOfLayers?k.numberOfLayers-2:100,disabled:0===k.numberOfLayers,labelStepSize:10*Math.ceil(1+k.numberOfLayers/200),onChange:function(e){return k.setActiveLayer(e)}}))):null)});_.render(d.createElement(Ue,null),document.getElementById("main"))}},[[64,1,2]]]);
//# sourceMappingURL=main.89077c6e.chunk.js.map