(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{62:function(e,t,i){e.exports=i(81)},81:function(e,t,i){"use strict";i.r(t);var r,n,s,a,o,c,l,u,h,d=i(0),f=i.n(d),_=i(15),v=i(17),b=i(90),p=(i(67),i(68),i(89)),m=i(24),y=i(84),g=i(18),O=i(87),w=i(16),E=i(26),x=i(27),I=i(28),j=i(22),k=(i(69),i(10)),A=new(r=k.b.bound,n=k.b.bound,s=k.e.ref,a=function(){function e(){Object(x.a)(this,e),Object(E.a)(this,"transform",o,this),Object(E.a)(this,"activeLayer",c,this),Object(E.a)(this,"trackProgress",l,this),Object(E.a)(this,"drawSettings",u,this),Object(E.a)(this,"activeGCode",h,this)}return Object(I.a)(e,[{key:"setDrawSetting",value:function(e,t){}},{key:"setActiveLayer",value:function(e){this.activeLayer=e}},{key:"setTransform",value:function(e){this.transform=e}},{key:"setActiveGCode",value:function(e){this.activeGCode=e,this.activeLayer=1}},{key:"numberOfLayers",get:function(){return null===this.activeGCode?0:this.activeGCode.numberOfLayers}}]),e}(),o=Object(j.a)(a.prototype,"transform",[k.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{k:1,x:0,y:0}}}),c=Object(j.a)(a.prototype,"activeLayer",[k.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(j.a)(a.prototype,"trackProgress",[k.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=Object(j.a)(a.prototype,"drawSettings",[k.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{lineWidth:8,coloringMode:"feed_rate",toolColors:["blue","green","red","orange","black"],scaleLinewidth:!0}}}),Object(j.a)(a.prototype,"setDrawSetting",[r],Object.getOwnPropertyDescriptor(a.prototype,"setDrawSetting"),a.prototype),Object(j.a)(a.prototype,"numberOfLayers",[k.c],Object.getOwnPropertyDescriptor(a.prototype,"numberOfLayers"),a.prototype),Object(j.a)(a.prototype,"setActiveLayer",[k.b],Object.getOwnPropertyDescriptor(a.prototype,"setActiveLayer"),a.prototype),Object(j.a)(a.prototype,"setTransform",[n],Object.getOwnPropertyDescriptor(a.prototype,"setTransform"),a.prototype),Object(j.a)(a.prototype,"setActiveGCode",[k.b],Object.getOwnPropertyDescriptor(a.prototype,"setActiveGCode"),a.prototype),h=Object(j.a)(a.prototype,"activeGCode",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a),C=i(25),T=0,S="0".charCodeAt(0),N="9".charCodeAt(0),L=".".charCodeAt(0),z="-".charCodeAt(0),F=" ".charCodeAt(0),R="\t".charCodeAt(0),D="A".charCodeAt(0),G="Z".charCodeAt(0),P="\n".charCodeAt(0),H="\r".charCodeAt(0),U=";".charCodeAt(0),W={MOVE_WITH_EXTRUSION:1,MOVE_WITHOUT_EXTRUSION:2,SET_FEED_RATE:3,RETRACTION:4,LAYER_CHANGE:5,TOOL_CHANGE:6},M=32768,B=[1,10,100,1e3,1e4,1e5,1e6],V=[.1,.01,.001,1e-4,1e-5,1e-6],X=function(){function e(){Object(x.a)(this,e),this.state=T,this.field=0,this.value_start=void 0,this.dot_position=void 0,this.prev_character=void 0,this.field_values=new Float32Array(27),this.axis_coordinates_absolute=!0,this.extruder_coordinates_absolute=!1,this.feed_rate=0,this.current_tool=0,this.prev_z=0,this.last_z_with_extrusion=void 0,this.last_feed_rate_with_extrusion=void 0,this.current_layer_index=0,this.layer_positions=[],this.layer_heights=[],this.prev_x=0,this.prev_y=0,this.prev_e=0,this.instructions=new Y(M),this.byte_index=0,this.last_block=void 0,this.statistics={x:{min:1/0,max:-1/0},y:{min:1/0,max:-1/0},feed_rate:{min:1/0,max:-1/0},extruded_feed_rate:{min:1/0,max:-1/0}},this.field_values.fill(NaN)}return Object(I.a)(e,[{key:"parse",value:function(e){for(var t,i=new Uint8Array(e),r=0;r<i.length;++r){if((t=i[r])>=S&&t<=N||t===L||t===z)t===L&&(this.dot_position=r);else if(t===F||t===R){if(1===this.state&&this.value_start){if(void 0!==this.last_block){for(var n=new Uint8Array(Array.from(this.last_block).concat(Array.from(i.slice(0,r)))),s=n.length,a=0;a<n.length;++a)n[a]===L&&(s=a);this.field_values[this.field-65]=this.pFloat(n,0,n.length,s),this.last_block=void 0}else this.field_values[this.field-65]=this.pFloat(i,this.value_start,r,this.dot_position?this.dot_position:r);this.value_start=void 0,this.dot_position=void 0,this.state=T}}else if(t>=D&&t<=G)this.state===T&&(this.field=i[r],this.state=1,this.value_start=r+1);else if(t!==H&&t!==P||this.prev_character===H||this.prev_character===P)t===U&&(this.state=2);else{if(this.value_start&&(this.field_values[this.field-65]=this.pFloat(i,this.value_start,r,this.dot_position?this.dot_position:r)),this.state=T,this.value_start=void 0,this.dot_position=void 0,isNaN(this.field_values[6]))if(isNaN(this.field_values[12]))isNaN(this.field_values[19])||(this.instructions.addInstruction(W.TOOL_CHANGE,this.field_values[19]),this.current_tool=this.field_values[19]);else switch(this.field_values[12]){case 82:this.extruder_coordinates_absolute=!0;break;case 83:this.extruder_coordinates_absolute=!1}else switch(this.field_values[6]){case 0:case 1:var o,c,l;if(!isNaN(this.field_values[23])||!isNaN(this.field_values[24]))!isNaN(this.field_values[4])&&(this.extruder_coordinates_absolute&&this.field_values[4]>this.prev_e||!this.extruder_coordinates_absolute&&this.field_values[4]>0)?(this.prev_z!==this.last_z_with_extrusion&&(this.instructions.addInstruction(W.LAYER_CHANGE,this.prev_z),this.layer_positions.push(this.instructions.totalInstructions),this.layer_heights.push(this.prev_z),this.current_layer_index+=1,this.instructions.addInstruction(W.MOVE_WITHOUT_EXTRUSION,this.prev_x,this.prev_y),this.instructions.addInstruction(W.SET_FEED_RATE,this.feed_rate),this.instructions.addInstruction(W.TOOL_CHANGE,this.current_tool)),o=W.MOVE_WITH_EXTRUSION,this.last_z_with_extrusion=this.prev_z,this.feed_rate!==this.last_feed_rate_with_extrusion&&(this.feed_rate>this.statistics.extruded_feed_rate.max&&(this.statistics.extruded_feed_rate.max=this.feed_rate),this.feed_rate<this.statistics.extruded_feed_rate.min&&(this.statistics.extruded_feed_rate.min=this.feed_rate)),this.last_feed_rate_with_extrusion=this.feed_rate):o=W.MOVE_WITHOUT_EXTRUSION,isNaN(this.field_values[23])?c=this.prev_x:((c=this.axis_coordinates_absolute?this.field_values[23]:this.prev_x+this.field_values[23])>this.statistics.x.max&&(this.statistics.x.max=c),c<this.statistics.x.min&&(this.statistics.x.min=c)),isNaN(this.field_values[24])?l=this.prev_y:((l=this.axis_coordinates_absolute?this.field_values[24]:this.prev_y+this.field_values[24])>this.statistics.y.max&&(this.statistics.y.max=l),l<this.statistics.y.min&&(this.statistics.y.min=l)),this.instructions.addInstruction(o,c,l),this.prev_x=c,this.prev_y=l;isNaN(this.field_values[5])||(this.feed_rate=this.field_values[5],this.instructions.addInstruction(W.SET_FEED_RATE,this.field_values[5]),this.feed_rate>this.statistics.feed_rate.max&&(this.statistics.feed_rate.max=this.feed_rate),this.feed_rate<this.statistics.feed_rate.min&&(this.statistics.feed_rate.min=this.feed_rate)),isNaN(this.field_values[25])||(this.field_values[25]>this.prev_z&&this.instructions.addInstruction(W.RETRACTION),this.prev_z=this.field_values[25]);break;case 90:this.axis_coordinates_absolute=!0;break;case 91:this.axis_coordinates_absolute=!1}for(var u=0;u<27;u++)this.field_values[u]=NaN}this.prev_character=t,this.byte_index+=1}1===this.state&&(this.last_block=i.slice(this.value_start))}},{key:"pFloat",value:function(e,t,i,r){for(var n=0,s=!1,a=t;a<i;++a){var o=e[a]-48;a===t&&e[a]===z?s=!0:a<r?n+=o*B[r-a-1]:a>r&&(n+=o*V[a-r-1])}return s?-n:n}},{key:"getParsingResult",value:function(){return{instructions:this.instructions,layerPositions:this.layer_positions,layerHeights:this.layer_heights,statistics:this.statistics,lineIndex:[]}}}]),e}(),Y=function(){function e(t){Object(x.a)(this,e),this.blockSizeInInstructions=void 0,this.buffers=[],this.currentBuffer=0,this.currentInstruction=0,this.currentFloat32Array=void 0,this.totalInstructions=0,this.blockSizeInInstructions=t,this.buffers.push(new ArrayBuffer(3*this.blockSizeInInstructions*4)),this.currentFloat32Array=new Float32Array(this.buffers[this.currentBuffer])}return Object(I.a)(e,[{key:"addInstruction",value:function(e,t,i){this.currentFloat32Array[3*this.currentInstruction]=e,void 0!==t&&(this.currentFloat32Array[3*this.currentInstruction+1]=t),void 0!==i&&(this.currentFloat32Array[3*this.currentInstruction+2]=i),this.currentInstruction+=1,this.totalInstructions+=1,this.currentInstruction>=this.blockSizeInInstructions&&(this.buffers.push(new ArrayBuffer(3*this.blockSizeInInstructions*4)),this.currentBuffer+=1,this.currentInstruction=0,this.currentFloat32Array=new Float32Array(this.buffers[this.currentBuffer]))}}]),e}(),J=i(52),Z=i(3),q=i(51),K=i(53),Q=i(83);function $(){var e=Object(v.a)(["\n  position: absolute;\n  padding: 5px;\n  background-color: transparent;\n"]);return $=function(){return e},e}function ee(){var e=Object(v.a)(["\n  flex: 1;\n"]);return ee=function(){return e},e}var te=g.a.canvas(ee()),ie=g.a.div($()),re=Object(w.a)(function(e){var t=e.currentLayer,i=e.activeGCode,r=e.transform,n=e.setTransform,s=e.drawSettings,a=Object(d.useState)(null),o=Object(C.a)(a,2),c=o[0],l=o[1],u=Object(d.useRef)(null),h=Object(k.b)("update transform",function(){n(Z.b.transform)});function f(){null!==u.current&&null!==c&&null!==i&&(function(e,t){t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.restore()}(u.current,c),function(e,t,i,r,n,s,a,o){var c=Object(q.a)().domain([o.extruded_feed_rate.min,o.extruded_feed_rate.max]).range([0,.8]),l=0,u=0;e.setTransform(n.k*s,0,0,n.k*s,n.x*s,n.y*s),a.scaleLinewidth?e.lineWidth=a.lineWidth/50:e.lineWidth=a.lineWidth/n.k;e.lineCap="round",e.beginPath();for(var h,d,f,_,v=Math.floor(t/r.blockSizeInInstructions),b=Math.floor(i/r.blockSizeInInstructions),p=v;p<=b;++p){h=new Float32Array(r.buffers[p]);for(var m=t-p*r.blockSizeInInstructions,y=i-p*r.blockSizeInInstructions,g=3*m;g<3*y;g+=3)switch(d=h[g],f=h[g+1],_=h[g+2],d){case W.MOVE_WITHOUT_EXTRUSION:e.moveTo(f,_),l=f,u=_;break;case W.MOVE_WITH_EXTRUSION:e.lineTo(f,_),l=f,u=_;break;case W.SET_FEED_RATE:"feed_rate"===a.coloringMode&&(e.stroke(),e.beginPath(),e.moveTo(l,u),e.strokeStyle=Object(K.a)(c(f)));break;case W.TOOL_CHANGE:if("tool"===a.coloringMode){e.stroke(),e.beginPath(),e.moveTo(l,u);var O=a.toolColors[f];e.strokeStyle=O||"grey"}}}e.stroke()}(c,i.layerPositions[t],i.layerPositions[t+1],i.instructions,r,devicePixelRatio,s,i.statistics))}Object(d.useEffect)(function(){if(c)f();else{u.current&&l(u.current.getContext("2d"));var e=Object(J.a)().on("zoom",h).scaleExtent([1,128]);null!==u.current&&e(Object(Z.f)(u.current))}});s.lineWidth,s.coloringMode,s.scaleLinewidth;return d.createElement(Q.a,{onResize:function(){if(null!==u.current){var e=u.current.clientHeight,t=u.current.clientWidth,i=window.devicePixelRatio||1;u.current.width===t*i&&u.current.height===e*i||(u.current.width=t*i,u.current.height=e*i),f()}}},d.createElement(d.Fragment,null,d.createElement(ie,null,"Layer ",t,d.createElement("br",null),"Layer height: ",i.layerHeights[t].toFixed(2)),d.createElement(te,{ref:u})))});var ne=Object(w.a)(function(e){var t=e.UIStore,i=t.activeGCode,r=t.transform,n=t.setTransform,s=t.drawSettings;if(i&&i.connection&&i.connection.progress){var a=function(e,t){for(var i=0;i<t.lineIndex.length;++i)if(t.lineIndex[i]>e)return i;return t.lineIndex.length}(i.connection.progress.filepos,i);(function(e,t){for(var i=0;i<e.length;++i)if(e[i]>t)return e[i-1];e.length})(i.layerPositions,a);return d.createElement(re,{currentLayer:0,activeGCode:i,transform:r,setTransform:n,drawSettings:s})}return d.createElement("div",null,"No GCode")});var se=i(37),ae=i.n(se),oe=i(49),ce=i(54),le=i(58);function ue(e){return new Promise(function(t,i){var r=e[0],n=new FileReader,s=0,a=new X,o=performance.now();function c(){var e=r.slice(s,s+1048576);n.readAsArrayBuffer(e)}n.onload=function(){if(a.parse(n.result),(s+=1048576)<r.size)c();else{var e=performance.now()-o,i=r.size/1024/1024;console.log("Read ".concat(i.toFixed(2)," megabytes in ").concat(e.toFixed(0)," ms. ").concat((e/i).toFixed(0)," ms/megabyte"));var l=a.getParsingResult();t(Object(le.a)({name:r.name,numberOfLayers:l.layerPositions.length},l))}},c()})}function he(){var e=Object(v.a)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 20px;\n  margin: 10px;\n  border-width: 4px;\n  border-radius: 2px;\n  border-color: #bbb;\n  border-style: dashed;\n  background-color: #fafafa;\n  color: #333;\n"]);return he=function(){return e},e}var de=g.a.div(he());function fe(e){var t=e.onFileLoad,i=Object(d.useCallback)(function(){var e=Object(oe.a)(ae.a.mark(function e(i){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return A.setActiveGCode(null),e.next=3,ue(i);case 3:r=e.sent,A.setActiveGCode(r),t&&t();case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[]),r=Object(ce.a)({onDrop:i}),n=r.getRootProps,s=r.getInputProps,a=r.isDragActive;return f.a.createElement(de,n(),f.a.createElement("input",s()),a?f.a.createElement("p",null,"Drop the files here ..."):f.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files"))}function _e(){var e=Object(v.a)(["\n  flex: 1;\n  display: flex;\n"]);return _e=function(){return e},e}var ve=g.a.div(_e()),be=Object(w.a)(function(e){var t=e.UIStore,i=t.activeGCode,r=t.activeLayer,n=t.transform,s=t.setTransform,a=t.drawSettings,o=Object(d.useState)(!1),c=Object(C.a)(o,2),l=c[0],u=c[1];return i&&!l?d.createElement(ve,{onDragOver:function(e){u(!0)},onDragLeave:function(e){u(!1)}},d.createElement(re,{currentLayer:r,activeGCode:i,transform:n,setTransform:s,drawSettings:a})):d.createElement(fe,{onFileLoad:function(){return u(!1)}})}),pe=i(57),me=i(29),ye=i(88),ge=i(8),Oe=i(86),we=i(38),Ee=i(85),xe=Object(w.a)(function(e){var t=Object(d.useState)(!1),i=Object(C.a)(t,2),r=i[0],n=i[1];return d.createElement(d.Fragment,null,d.createElement(me.a,{className:"bp3-minimal",icon:"cog",text:"Draw settings",onClick:function(){return n(!0)}}),d.createElement(Ie,Object.assign({isOpen:r,handleClose:function(){return n(!1)}},e)))}),Ie=Object(w.a)(function(e){var t=e.isOpen,i=e.handleClose,r=Object(pe.a)(e,["isOpen","handleClose"]);return d.createElement(ye.a,{isOpen:t,icon:"cog",size:"20%",hasBackdrop:!1,onClose:i,title:"Draw Settings"},d.createElement("div",{className:ge.a.DRAWER_BODY},d.createElement("div",{className:ge.a.DIALOG_BODY},d.createElement(je,r))))}),je=Object(w.a)(function(e){var t=e.drawSettings;return d.createElement("div",null,d.createElement(y.a,{label:"Linewidth",labelFor:"linewidth-input"},d.createElement(Oe.a,{value:t.lineWidth,id:"linewidth-input",onValueChange:Object(k.b)("set line width",function(e){return t.lineWidth=e})})),d.createElement(we.a,{checked:t.scaleLinewidth,label:"Scale linewidth with zoom",onChange:Object(k.b)("set line width scaling",function(e){return t.scaleLinewidth=e.target.checked})}),d.createElement(Ee.a,{label:"Coloring mode",selectedValue:t.coloringMode,onChange:Object(k.b)("set coloring mode",function(e){t.coloringMode=e.target.value})},d.createElement(we.b,{label:"by feed rate",value:"feed_rate"}),d.createElement(we.b,{label:"by tool",value:"tool"})))});function ke(){var e=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 3;\n  padding: 0 20px 0 20px;\n"]);return ke=function(){return e},e}function Ae(){var e=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 2;\n  background: white;\n  display: flex;\n"]);return Ae=function(){return e},e}function Ce(){var e=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 1;\n  gap: 0;\n"]);return Ce=function(){return e},e}function Te(){var e=Object(v.a)(["\n  background: #eee;\n  display: grid;\n  grid-template-columns: 200px minmax(0, 1fr);\n  grid-template-rows: auto minmax(0, 1fr) auto;\n  width: 100vw;\n  height: 100vh;\n  align-self: stretch;\n  overflow: hidden;\n"]);return Te=function(){return e},e}b.a.onlyShowFocusOnTabs();var Se=g.a.div(Te()),Ne=g.a.div(Ce()),Le=g.a.div(Ae()),ze=g.a.div(ke()),Fe=Object(w.a)(function(e){return d.createElement(Se,null,d.createElement(Ne,null,d.createElement(p.a,{className:"bp3-dark"},d.createElement(p.a.Group,{align:m.a.LEFT},d.createElement(p.a.Heading,null,"G-Code viewer for 3D printing"),d.createElement(p.a.Divider,null),d.createElement(xe,{drawSettings:A.drawSettings,setDrawSetting:A.setDrawSetting})))),d.createElement(Le,null,A.trackProgress?d.createElement(ne,{UIStore:A}):d.createElement(be,{UIStore:A})),A.activeGCode?d.createElement(ze,null,d.createElement(y.a,{label:"Current layer"},d.createElement(O.a,{value:A.activeLayer,min:1,max:0!==A.numberOfLayers?A.numberOfLayers-2:100,disabled:0===A.numberOfLayers,labelStepSize:10*Math.ceil(1+A.numberOfLayers/200),onChange:function(e){return A.setActiveLayer(e)}}))):null)});_.render(d.createElement(Fe,null),document.getElementById("main"))}},[[62,1,2]]]);
//# sourceMappingURL=main.a81fbd42.chunk.js.map