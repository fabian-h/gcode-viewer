(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{61:function(t,e,i){t.exports=i(80)},80:function(t,e,i){"use strict";i.r(e);var r,n,s,a,o,c,l,u,h,d=i(0),f=i.n(d),_=i(14),v=i(17),b=i(88),p=(i(66),i(67),i(87)),m=i(24),O=i(83),y=i(18),g=i(85),x=i(16),w=i(26),E=i(27),I=i(28),j=i(22),A=(i(68),i(10)),k=new(r=A.b.bound,n=A.b.bound,s=A.e.ref,a=function(){function t(){Object(E.a)(this,t),Object(w.a)(this,"transform",o,this),Object(w.a)(this,"activeLayer",c,this),Object(w.a)(this,"trackProgress",l,this),Object(w.a)(this,"drawSettings",u,this),Object(w.a)(this,"activeGCode",h,this)}return Object(I.a)(t,[{key:"setDrawSetting",value:function(t,e){this.drawSettings[t]=e}},{key:"setActiveLayer",value:function(t){this.activeLayer=t}},{key:"setTransform",value:function(t){this.transform=t}},{key:"setActiveGCode",value:function(t){this.activeGCode=t,this.activeLayer=1}},{key:"numberOfLayers",get:function(){return null===this.activeGCode?0:this.activeGCode.numberOfLayers}}]),t}(),o=Object(j.a)(a.prototype,"transform",[A.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{k:1,x:0,y:0}}}),c=Object(j.a)(a.prototype,"activeLayer",[A.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(j.a)(a.prototype,"trackProgress",[A.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=Object(j.a)(a.prototype,"drawSettings",[A.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{lineWidth:2}}}),Object(j.a)(a.prototype,"setDrawSetting",[r],Object.getOwnPropertyDescriptor(a.prototype,"setDrawSetting"),a.prototype),Object(j.a)(a.prototype,"numberOfLayers",[A.c],Object.getOwnPropertyDescriptor(a.prototype,"numberOfLayers"),a.prototype),Object(j.a)(a.prototype,"setActiveLayer",[A.b],Object.getOwnPropertyDescriptor(a.prototype,"setActiveLayer"),a.prototype),Object(j.a)(a.prototype,"setTransform",[n],Object.getOwnPropertyDescriptor(a.prototype,"setTransform"),a.prototype),Object(j.a)(a.prototype,"setActiveGCode",[A.b],Object.getOwnPropertyDescriptor(a.prototype,"setActiveGCode"),a.prototype),h=Object(j.a)(a.prototype,"activeGCode",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a),S=i(25),T=0,C="0".charCodeAt(0),N="9".charCodeAt(0),z=".".charCodeAt(0),D="-".charCodeAt(0),L=" ".charCodeAt(0),R="\t".charCodeAt(0),F="A".charCodeAt(0),G="Z".charCodeAt(0),P="\n".charCodeAt(0),U="\r".charCodeAt(0),W=";".charCodeAt(0),H={MOVE_WITH_EXTRUSION:1,MOVE_WITHOUT_EXTRUSION:2,SET_FEED_RATE:3,RETRACTION:4,LAYER_CHANGE:5,TOOL_CHANGE:6},B=32768,M=[1,10,100,1e3,1e4,1e5,1e6],V=[.1,.01,.001,1e-4,1e-5,1e-6],X=function(){function t(){Object(E.a)(this,t),this.state=T,this.field=0,this.value_start=void 0,this.dot_position=void 0,this.prev_character=void 0,this.field_values=new Float32Array(27),this.axis_coordinates_absolute=!0,this.extruder_coordinates_absolute=!1,this.feed_rate=0,this.current_tool=0,this.prev_z=0,this.last_z_with_extrusion=void 0,this.last_feed_rate_with_extrusion=void 0,this.current_layer_index=0,this.layer_positions=[],this.prev_x=0,this.prev_y=0,this.prev_e=0,this.instructions=new Y(B),this.byte_index=0,this.last_block=void 0,this.statistics={x:{min:1/0,max:-1/0},y:{min:1/0,max:-1/0},feed_rate:{min:1/0,max:-1/0},extruded_feed_rate:{min:1/0,max:-1/0}},this.field_values.fill(NaN)}return Object(I.a)(t,[{key:"parse",value:function(t){for(var e,i=new Uint8Array(t),r=0;r<i.length;++r){if((e=i[r])>=C&&e<=N||e===z||e===D)e===z&&(this.dot_position=r);else if(e===L||e===R){if(1===this.state&&this.value_start){if(void 0!==this.last_block){for(var n=new Uint8Array(Array.from(this.last_block).concat(Array.from(i.slice(0,r)))),s=n.length,a=0;a<n.length;++a)n[a]===z&&(s=a);this.field_values[this.field-65]=this.pFloat(n,0,n.length,s),this.last_block=void 0}else this.field_values[this.field-65]=this.pFloat(i,this.value_start,r,this.dot_position?this.dot_position:r);this.value_start=void 0,this.dot_position=void 0,this.state=T}}else if(e>=F&&e<=G)this.state===T&&(this.field=i[r],this.state=1,this.value_start=r+1);else if(e!==U&&e!==P||this.prev_character===U||this.prev_character===P)e===W&&(this.state=2);else{if(this.value_start&&(this.field_values[this.field-65]=this.pFloat(i,this.value_start,r,this.dot_position?this.dot_position:r)),this.state=T,this.value_start=void 0,this.dot_position=void 0,isNaN(this.field_values[6]))if(isNaN(this.field_values[12]))isNaN(this.field_values[19])||(this.instructions.addInstruction(H.TOOL_CHANGE,this.field_values[19]),this.current_tool=this.field_values[19]);else switch(this.field_values[12]){case 82:this.extruder_coordinates_absolute=!0;break;case 83:this.extruder_coordinates_absolute=!1}else switch(this.field_values[6]){case 0:case 1:var o,c,l;if(!isNaN(this.field_values[23])||!isNaN(this.field_values[24]))!isNaN(this.field_values[4])&&(this.extruder_coordinates_absolute&&this.field_values[4]>this.prev_e||!this.extruder_coordinates_absolute&&this.field_values[4]>0)?(this.prev_z!==this.last_z_with_extrusion&&(this.instructions.addInstruction(H.LAYER_CHANGE,this.prev_z),this.layer_positions.push(this.instructions.totalInstructions),this.current_layer_index+=1,this.instructions.addInstruction(H.MOVE_WITHOUT_EXTRUSION,this.prev_x,this.prev_y),this.instructions.addInstruction(H.SET_FEED_RATE,this.feed_rate)),o=H.MOVE_WITH_EXTRUSION,this.last_z_with_extrusion=this.prev_z,this.feed_rate!==this.last_feed_rate_with_extrusion&&(this.feed_rate>this.statistics.extruded_feed_rate.max&&(this.statistics.extruded_feed_rate.max=this.feed_rate),this.feed_rate<this.statistics.extruded_feed_rate.min&&(this.statistics.extruded_feed_rate.min=this.feed_rate)),this.last_feed_rate_with_extrusion=this.feed_rate):o=H.MOVE_WITHOUT_EXTRUSION,isNaN(this.field_values[23])?c=this.prev_x:((c=this.axis_coordinates_absolute?this.field_values[23]:this.prev_x+this.field_values[23])>this.statistics.x.max&&(this.statistics.x.max=c),c<this.statistics.x.min&&(this.statistics.x.min=c)),isNaN(this.field_values[24])?l=this.prev_y:((l=this.axis_coordinates_absolute?this.field_values[24]:this.prev_y+this.field_values[24])>this.statistics.y.max&&(this.statistics.y.max=l),l<this.statistics.y.min&&(this.statistics.y.min=l)),this.instructions.addInstruction(o,c,l),this.prev_x=c,this.prev_y=l;isNaN(this.field_values[5])||(this.feed_rate=this.field_values[5],this.instructions.addInstruction(H.SET_FEED_RATE,this.field_values[5]),this.feed_rate>this.statistics.feed_rate.max&&(this.statistics.feed_rate.max=this.feed_rate),this.feed_rate<this.statistics.feed_rate.min&&(this.statistics.feed_rate.min=this.feed_rate)),isNaN(this.field_values[25])||(this.field_values[25]>this.prev_z&&this.instructions.addInstruction(H.RETRACTION),this.prev_z=this.field_values[25]);break;case 90:this.axis_coordinates_absolute=!0;break;case 91:this.axis_coordinates_absolute=!1}for(var u=0;u<27;u++)this.field_values[u]=NaN}this.prev_character=e,this.byte_index+=1}1===this.state&&(this.last_block=i.slice(this.value_start))}},{key:"pFloat",value:function(t,e,i,r){for(var n=0,s=!1,a=e;a<i;++a){var o=t[a]-48;a===e&&t[a]===D?s=!0:a<r?n+=o*M[r-a-1]:a>r&&(n+=o*V[a-r-1])}return s?-n:n}},{key:"getParsingResult",value:function(){return{instructions:this.instructions,layerPositions:this.layer_positions,statistics:this.statistics,lineIndex:[]}}}]),t}(),Y=function(){function t(e){Object(E.a)(this,t),this.blockSizeInInstructions=void 0,this.buffers=[],this.currentBuffer=0,this.currentInstruction=0,this.currentFloat32Array=void 0,this.totalInstructions=0,this.blockSizeInInstructions=e,this.buffers.push(new ArrayBuffer(3*this.blockSizeInInstructions*4)),this.currentFloat32Array=new Float32Array(this.buffers[this.currentBuffer])}return Object(I.a)(t,[{key:"addInstruction",value:function(t,e,i){this.currentFloat32Array[3*this.currentInstruction]=t,void 0!==e&&(this.currentFloat32Array[3*this.currentInstruction+1]=e),void 0!==i&&(this.currentFloat32Array[3*this.currentInstruction+2]=i),this.currentInstruction+=1,this.totalInstructions+=1,this.currentInstruction>=this.blockSizeInInstructions&&(this.buffers.push(new ArrayBuffer(3*this.blockSizeInInstructions*4)),this.currentBuffer+=1,this.currentInstruction=0,this.currentFloat32Array=new Float32Array(this.buffers[this.currentBuffer]))}}]),t}(),J=i(51),Z=i(3),q=i(50),K=i(52),Q=i(82);function $(){var t=Object(v.a)(["\n  flex: 1;\n"]);return $=function(){return t},t}var tt=y.a.canvas($()),et=Object(x.a)(function(t){var e=t.from,i=t.to,r=t.activeGCode,n=t.transform,s=t.setTransform,a=t.drawSettings,o=Object(d.useState)(null),c=Object(S.a)(o,2),l=c[0],u=c[1],h=Object(d.useRef)(null),f=Object(A.b)("update transform",function(){s(Z.b.transform)});function _(){null!==h.current&&null!==l&&null!==r&&(function(t,e){e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),e.restore()}(h.current,l),function(t,e,i,r,n,s,a,o){var c=Object(q.a)().domain([o.extruded_feed_rate.min,o.extruded_feed_rate.max]).range([0,.8]),l=0,u=0;t.setTransform(n.k*s,0,0,n.k*s,n.x*s,n.y*s),t.lineWidth=a.lineWidth/n.k,t.lineCap="round",t.beginPath();for(var h,d,f,_,v=Math.floor(e/r.blockSizeInInstructions),b=Math.floor(i/r.blockSizeInInstructions),p=v;p<=b;++p){h=new Float32Array(r.buffers[p]);for(var m=e-p*r.blockSizeInInstructions,O=i-p*r.blockSizeInInstructions,y=3*m;y<3*O;y+=3)switch(d=h[y],f=h[y+1],_=h[y+2],d){case H.MOVE_WITHOUT_EXTRUSION:t.moveTo(f,_),l=f,u=_;break;case H.MOVE_WITH_EXTRUSION:t.lineTo(f,_),l=f,u=_;break;case H.SET_FEED_RATE:t.stroke(),t.beginPath(),t.moveTo(l,u),t.strokeStyle=Object(K.a)(c(f))}}t.stroke()}(l,e,i,r.instructions,n,devicePixelRatio,a,r.statistics))}Object(d.useEffect)(function(){if(l)_();else{h.current&&u(h.current.getContext("2d"));var t=Object(J.a)().on("zoom",f).scaleExtent([1,128]);null!==h.current&&t(Object(Z.f)(h.current))}});a.lineWidth;return d.createElement(Q.a,{onResize:function(){if(null!==h.current){var t=h.current.clientHeight,e=h.current.clientWidth,i=window.devicePixelRatio||1;h.current.width===e*i&&h.current.height===t*i||(h.current.width=e*i,h.current.height=t*i),_()}}},d.createElement(tt,{ref:h}))});var it=Object(x.a)(function(t){var e=t.UIStore,i=e.activeGCode,r=e.transform,n=e.setTransform,s=e.drawSettings;if(i&&i.connection&&i.connection.progress){var a=function(t,e){for(var i=0;i<e.lineIndex.length;++i)if(e.lineIndex[i]>t)return i;return e.lineIndex.length}(i.connection.progress.filepos,i),o=function(t,e){for(var i=0;i<t.length;++i)if(t[i]>e)return t[i-1];return t.length}(i.layerPositions,a),c=a;return d.createElement(et,{from:o,to:c,activeGCode:i,transform:r,setTransform:n,drawSettings:s})}return d.createElement("div",null,"No GCode")});var rt=i(37),nt=i.n(rt),st=i(48),at=i(53),ot=i(57);function ct(t){return new Promise(function(e,i){var r=t[0],n=new FileReader,s=0,a=new X,o=performance.now();function c(){var t=r.slice(s,s+1048576);n.readAsArrayBuffer(t)}n.onload=function(){if(a.parse(n.result),(s+=1048576)<r.size)c();else{var t=performance.now()-o,i=r.size/1024/1024;console.log("Read ".concat(i.toFixed(2)," megabytes in ").concat(t.toFixed(0)," ms. ").concat((t/i).toFixed(0)," ms/megabyte"));var l=a.getParsingResult();e(Object(ot.a)({name:r.name,numberOfLayers:l.layerPositions.length},l))}},c()})}function lt(){var t=Object(v.a)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 20px;\n  margin: 10px;\n  border-width: 4px;\n  border-radius: 2px;\n  border-color: #bbb;\n  border-style: dashed;\n  background-color: #fafafa;\n  color: #333;\n"]);return lt=function(){return t},t}var ut=y.a.div(lt());function ht(t){var e=t.onFileLoad,i=Object(d.useCallback)(function(){var t=Object(st.a)(nt.a.mark(function t(i){var r;return nt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return k.setActiveGCode(null),t.next=3,ct(i);case 3:r=t.sent,k.setActiveGCode(r),e&&e();case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),[]),r=Object(at.a)({onDrop:i}),n=r.getRootProps,s=r.getInputProps,a=r.isDragActive;return f.a.createElement(ut,n(),f.a.createElement("input",s()),a?f.a.createElement("p",null,"Drop the files here ..."):f.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files"))}function dt(){var t=Object(v.a)(["\n  flex: 1;\n  display: flex;\n"]);return dt=function(){return t},t}var ft=y.a.div(dt()),_t=Object(x.a)(function(t){var e=t.UIStore,i=e.activeGCode,r=e.activeLayer,n=e.transform,s=e.setTransform,a=e.drawSettings,o=Object(d.useState)(!1),c=Object(S.a)(o,2),l=c[0],u=c[1];return i&&!l?d.createElement(ft,{onDragOver:function(t){u(!0)},onDragLeave:function(t){u(!1)}},d.createElement(et,{from:i.layerPositions[r],to:i.layerPositions[r+1],activeGCode:i,transform:n,setTransform:s,drawSettings:a})):d.createElement(ht,{onFileLoad:function(){return u(!1)}})}),vt=i(56),bt=i(29),pt=i(86),mt=i(8),Ot=i(84),yt=Object(x.a)(function(t){var e=Object(d.useState)(!1),i=Object(S.a)(e,2),r=i[0],n=i[1];return d.createElement(d.Fragment,null,d.createElement(bt.a,{className:"bp3-minimal",icon:"cog",text:"Draw settings",onClick:function(){return n(!0)}}),d.createElement(gt,Object.assign({isOpen:r,handleClose:function(){return n(!1)}},t)))}),gt=Object(x.a)(function(t){var e=t.isOpen,i=t.handleClose,r=Object(vt.a)(t,["isOpen","handleClose"]);return d.createElement(pt.a,{isOpen:e,icon:"cog",size:"20%",hasBackdrop:!1,onClose:i,title:"Draw Settings"},d.createElement("div",{className:mt.a.DRAWER_BODY},d.createElement("div",{className:mt.a.DIALOG_BODY},d.createElement(xt,r))))}),xt=Object(x.a)(function(t){var e=t.drawSettings;t.setDrawSetting;return d.createElement("div",null,d.createElement(O.a,{label:"Linewidth",labelFor:"linewidth-input"},d.createElement(Ot.a,{value:e.lineWidth,id:"linewidth-input",onValueChange:Object(A.b)("set line width",function(t){return e.lineWidth=t})})))});function wt(){var t=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 3;\n  padding: 0 20px 0 20px;\n"]);return wt=function(){return t},t}function Et(){var t=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 2;\n  background: white;\n  display: flex;\n"]);return Et=function(){return t},t}function It(){var t=Object(v.a)(["\n  grid-column: 1/3;\n  grid-row: 1;\n  gap: 0;\n"]);return It=function(){return t},t}function jt(){var t=Object(v.a)(["\n  background: #eee;\n  display: grid;\n  grid-template-columns: 200px minmax(0, 1fr);\n  grid-template-rows: auto minmax(0, 1fr) auto;\n  width: 100vw;\n  height: 100vh;\n  align-self: stretch;\n  overflow: hidden;\n"]);return jt=function(){return t},t}b.a.onlyShowFocusOnTabs();var At=y.a.div(jt()),kt=y.a.div(It()),St=y.a.div(Et()),Tt=y.a.div(wt()),Ct=Object(x.a)(function(t){return d.createElement(At,null,d.createElement(kt,null,d.createElement(p.a,{className:"bp3-dark"},d.createElement(p.a.Group,{align:m.a.LEFT},d.createElement(p.a.Heading,null,"G-Code viewer for 3D printing"),d.createElement(p.a.Divider,null),d.createElement(yt,{drawSettings:k.drawSettings,setDrawSetting:k.setDrawSetting})))),d.createElement(St,null,k.trackProgress?d.createElement(it,{UIStore:k}):d.createElement(_t,{UIStore:k})),k.activeGCode?d.createElement(Tt,null,d.createElement(O.a,{label:"Current layer"},d.createElement(g.a,{value:k.activeLayer,min:1,max:0!==k.numberOfLayers?k.numberOfLayers-2:100,disabled:0===k.numberOfLayers,labelStepSize:10*Math.ceil(1+k.numberOfLayers/200),onChange:function(t){return k.setActiveLayer(t)}}))):null)});_.render(d.createElement(Ct,null),document.getElementById("main"))}},[[61,1,2]]]);
//# sourceMappingURL=main.83927997.chunk.js.map